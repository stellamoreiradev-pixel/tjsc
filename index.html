<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TJ-SC T√©cnico Judici√°rio ‚Äî Painel de Estudos</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;0,9..144,700;1,9..144,400&display=swap');

:root {
  --bg: #F7F6F3;
  --bg-card: #FFFFFF;
  --bg-hover: #F0EFEC;
  --text-primary: #1A1A1A;
  --text-secondary: #6B6B6B;
  --text-muted: #9B9B9B;
  --border: #E8E6E1;
  --border-light: #F0EFEC;
  --group-a: #DC2626;
  --group-a-bg: #FEF2F2;
  --group-a-border: #FECACA;
  --group-a-light: #FCA5A5;
  --group-b: #D97706;
  --group-b-bg: #FFFBEB;
  --group-b-border: #FDE68A;
  --group-b-light: #FCD34D;
  --group-c: #059669;
  --group-c-bg: #ECFDF5;
  --group-c-border: #A7F3D0;
  --group-c-light: #6EE7B7;
  --status-done: #059669;
  --status-progress: #2563EB;
  --status-review: #D97706;
  --status-pending: #9CA3AF;
  --accent: #4F46E5;
  --accent-light: #EEF2FF;
  --radius: 12px;
  --radius-sm: 8px;
  --radius-xs: 6px;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
  --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.05), 0 2px 4px rgba(0,0,0,0.04);
  --shadow-lg: 0 10px 25px rgba(0,0,0,0.08);
  --font-body: 'DM Sans', -apple-system, sans-serif;
  --font-display: 'Fraunces', Georgia, serif;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:smooth; }
body { font-family:var(--font-body); background:var(--bg); color:var(--text-primary); line-height:1.6; min-height:100vh; -webkit-font-smoothing:antialiased; }
:focus-visible { outline:2px solid var(--accent); outline-offset:2px; border-radius:2px; }
::-webkit-scrollbar { width:6px; height:6px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
::-webkit-scrollbar-thumb:hover { background:var(--text-muted); }
.app-shell { display:flex; min-height:100vh; }
.sidebar { width:260px; background:var(--bg-card); border-right:1px solid var(--border); padding:24px 0; display:flex; flex-direction:column; position:fixed; top:0;left:0;bottom:0; z-index:100; transition:transform 0.3s ease; }
.sidebar-header { padding:0 20px 20px; border-bottom:1px solid var(--border); margin-bottom:8px; }
.sidebar-logo { font-family:var(--font-display); font-size:20px; font-weight:700; color:var(--text-primary); letter-spacing:-0.02em; }
.sidebar-logo span { color:var(--accent); }
.sidebar-sub { font-size:11px; color:var(--text-muted); margin-top:2px; text-transform:uppercase; letter-spacing:0.08em; font-weight:500; }
.sidebar-nav { flex:1; padding:8px 12px; overflow-y:auto; }
.nav-section-label { font-size:10px; text-transform:uppercase; letter-spacing:0.1em; color:var(--text-muted); padding:16px 8px 6px; font-weight:600; }
.nav-item { display:flex; align-items:center; gap:10px; padding:9px 12px; border-radius:var(--radius-sm); cursor:pointer; font-size:13.5px; font-weight:500; color:var(--text-secondary); transition:all 0.15s; user-select:none; border:1px solid transparent; }
.nav-item:hover { background:var(--bg-hover); color:var(--text-primary); }
.nav-item.active { background:var(--accent-light); color:var(--accent); border-color:rgba(79,70,229,0.1); font-weight:600; }
.nav-item svg { width:18px; height:18px; flex-shrink:0; opacity:0.7; }
.nav-item.active svg { opacity:1; }
.nav-item .nav-badge { margin-left:auto; font-size:11px; font-weight:600; padding:1px 7px; border-radius:10px; background:var(--group-a-bg); color:var(--group-a); }
.sidebar-footer { padding:12px 20px; border-top:1px solid var(--border); display:flex; gap:6px; flex-wrap:wrap; }
.sidebar-footer button { flex:1; min-width:60px; padding:7px 10px; font-size:11px; font-weight:600; border:1px solid var(--border); border-radius:var(--radius-xs); background:var(--bg-card); color:var(--text-secondary); cursor:pointer; transition:all 0.15s; font-family:var(--font-body); }
.sidebar-footer button:hover { background:var(--bg-hover); color:var(--text-primary); }
.main-content { flex:1; margin-left:260px; min-height:100vh; }
.top-bar { position:sticky; top:0; z-index:50; background:rgba(247,246,243,0.85); backdrop-filter:blur(12px); border-bottom:1px solid var(--border); padding:12px 32px; display:flex; align-items:center; gap:16px; }
.menu-toggle { display:none; background:none; border:none; cursor:pointer; padding:4px; color:var(--text-secondary); }
.menu-toggle svg { width:22px; height:22px; }
.search-box { flex:1; max-width:420px; position:relative; }
.search-box svg { position:absolute; left:12px; top:50%; transform:translateY(-50%); width:16px; height:16px; color:var(--text-muted); }
.search-box input { width:100%; padding:9px 12px 9px 38px; border:1px solid var(--border); border-radius:var(--radius-sm); font-size:13.5px; font-family:var(--font-body); background:var(--bg-card); color:var(--text-primary); transition:all 0.15s; }
.search-box input:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(79,70,229,0.1); }
.search-box input::placeholder { color:var(--text-muted); }
.top-bar-right { display:flex; align-items:center; gap:12px; margin-left:auto; }
.page-content { padding:28px 32px 60px; max-width:1200px; }
.page-title { font-family:var(--font-display); font-size:26px; font-weight:700; color:var(--text-primary); margin-bottom:4px; letter-spacing:-0.02em; }
.page-subtitle { font-size:14px; color:var(--text-secondary); margin-bottom:28px; }
.card { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); padding:20px; box-shadow:var(--shadow-sm); }
.card-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
.card-title { font-size:14px; font-weight:600; color:var(--text-primary); }
.stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px; margin-bottom:24px; }
.stat-card { position:relative; overflow:hidden; }
.stat-card .stat-accent { position:absolute; top:0;left:0;right:0; height:3px; }
.stat-card.group-a .stat-accent { background:var(--group-a); }
.stat-card.group-b .stat-accent { background:var(--group-b); }
.stat-card.group-c .stat-accent { background:var(--group-c); }
.stat-card.general .stat-accent { background:var(--accent); }
.stat-label { font-size:12px; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.06em; font-weight:600; margin-bottom:8px; }
.stat-number { font-family:var(--font-display); font-size:28px; font-weight:700; color:var(--text-primary); }
.stat-sub { font-size:12px; color:var(--text-secondary); margin-top:4px; }
.progress-bar { height:8px; background:var(--border-light); border-radius:4px; overflow:hidden; margin-top:10px; }
.progress-fill { height:100%; border-radius:4px; transition:width 0.4s ease; }
.progress-fill.group-a { background:var(--group-a); }
.progress-fill.group-b { background:var(--group-b); }
.progress-fill.group-c { background:var(--group-c); }
.progress-fill.general { background:var(--accent); }
.section-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:24px; }
.section-title { font-size:16px; font-weight:600; color:var(--text-primary); margin-bottom:16px; display:flex; align-items:center; gap:8px; }
.section-title .dot { width:8px;height:8px; border-radius:50%; display:inline-block; }
.topic-list { display:flex; flex-direction:column; gap:2px; }
.topic-item { display:flex; align-items:center; gap:12px; padding:10px 14px; border-radius:var(--radius-sm); transition:all 0.12s; cursor:default; border:1px solid transparent; }
.topic-item:hover { background:var(--bg-hover); }
.topic-number { font-size:11px; font-weight:700; color:var(--text-muted); min-width:28px; text-align:center; background:var(--bg); padding:2px 6px; border-radius:var(--radius-xs); }
.topic-text { flex:1; font-size:13.5px; color:var(--text-primary); }
.topic-text.done { text-decoration:line-through; color:var(--text-muted); }
.topic-actions { display:flex; gap:4px; align-items:center; }
.status-select { font-size:12px; font-family:var(--font-body); padding:4px 8px; border:1px solid var(--border); border-radius:var(--radius-xs); background:var(--bg-card); color:var(--text-secondary); cursor:pointer; font-weight:500; transition:all 0.15s; appearance:none; -webkit-appearance:none; background-image:url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%239B9B9B' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 8px center; padding-right:24px; }
.status-select:focus { outline:none; border-color:var(--accent); }
.status-select.s-done { border-color:var(--group-c-border); color:var(--status-done); background-color:var(--group-c-bg); }
.status-select.s-progress { border-color:#BFDBFE; color:var(--status-progress); background-color:#EFF6FF; }
.status-select.s-review { border-color:var(--group-b-border); color:var(--status-review); background-color:var(--group-b-bg); }
.notes-btn { width:28px; height:28px; border:1px solid var(--border); border-radius:var(--radius-xs); background:var(--bg-card); cursor:pointer; display:flex; align-items:center; justify-content:center; color:var(--text-muted); transition:all 0.15s; }
.notes-btn:hover { background:var(--bg-hover); color:var(--text-primary); }
.notes-btn.has-notes { color:var(--accent); border-color:rgba(79,70,229,0.3); }
.notes-btn svg { width:14px; height:14px; }
.subject-card { background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; margin-bottom:16px; box-shadow:var(--shadow-sm); }
.subject-header { padding:16px 20px; display:flex; align-items:center; gap:14px; cursor:pointer; transition:background 0.12s; user-select:none; }
.subject-header:hover { background:var(--bg-hover); }
.subject-group-tag { font-size:11px; font-weight:700; padding:3px 10px; border-radius:20px; letter-spacing:0.05em; }
.subject-group-tag.group-a { background:var(--group-a-bg); color:var(--group-a); border:1px solid var(--group-a-border); }
.subject-group-tag.group-b { background:var(--group-b-bg); color:var(--group-b); border:1px solid var(--group-b-border); }
.subject-group-tag.group-c { background:var(--group-c-bg); color:var(--group-c); border:1px solid var(--group-c-border); }
.subject-name { font-size:15px; font-weight:600; color:var(--text-primary); flex:1; }
.subject-progress-mini { font-size:13px; font-weight:600; color:var(--text-secondary); }
.subject-chevron { width:20px;height:20px; color:var(--text-muted); transition:transform 0.2s; }
.subject-header.open .subject-chevron { transform:rotate(180deg); }
.subject-body { display:none; border-top:1px solid var(--border); padding:8px 12px 12px; }
.subject-body.open { display:block; }
.meta-row { display:flex; align-items:center; gap:12px; padding:12px 0; border-bottom:1px solid var(--border-light); }
.meta-row:last-child { border-bottom:none; }
.meta-label { font-size:13px; font-weight:600; color:var(--text-primary); min-width:80px; }
.meta-input { width:70px; padding:6px 10px; border:1px solid var(--border); border-radius:var(--radius-xs); font-size:13px; font-family:var(--font-body); text-align:center; color:var(--text-primary); }
.meta-input:focus { outline:none; border-color:var(--accent); }
.meta-bar { flex:1; height:6px; background:var(--border-light); border-radius:3px; overflow:hidden; }
.meta-bar-fill { height:100%; border-radius:3px; transition:width 0.3s; }
.redacao-card { border:1px solid var(--border); border-radius:var(--radius); padding:16px; margin-bottom:12px; background:var(--bg-card); }
.redacao-title { font-size:14px; font-weight:600; margin-bottom:10px; }
.check-row { display:flex; align-items:center; gap:8px; padding:4px 0; font-size:13px; color:var(--text-secondary); }
.check-row input[type="checkbox"] { accent-color:var(--accent); width:16px; height:16px; }
.redacao-notes { width:100%; margin-top:10px; padding:8px 12px; border:1px solid var(--border); border-radius:var(--radius-xs); font-size:13px; font-family:var(--font-body); resize:vertical; min-height:50px; color:var(--text-primary); }
.redacao-notes:focus { outline:none; border-color:var(--accent); }
.lei-seca-mode { background:#1A1A2E; color:#E8E6E1; min-height:100vh; padding:24px; }
.lei-seca-mode .topic-item { border-color:rgba(255,255,255,0.06); }
.lei-seca-mode .topic-item:hover { background:rgba(255,255,255,0.04); }
.lei-seca-mode .topic-text { color:#E8E6E1; }
.lei-seca-mode .topic-number { background:rgba(255,255,255,0.08); color:#9B9B9B; }
.lei-seca-mode .status-select { background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.1); color:#ccc; }
.lei-seca-header { display:flex; align-items:center; gap:16px; margin-bottom:24px; }
.lei-seca-header h2 { font-family:var(--font-display); font-size:22px; color:#F7F6F3; }
.lei-seca-back { padding:8px 16px; border:1px solid rgba(255,255,255,0.15); border-radius:var(--radius-xs); background:transparent; color:#ccc; font-size:13px; cursor:pointer; font-family:var(--font-body); font-weight:500; }
.lei-seca-back:hover { background:rgba(255,255,255,0.06); }
.lei-seca-stat { display:inline-flex; align-items:center; gap:8px; padding:6px 14px; background:rgba(255,255,255,0.06); border-radius:20px; font-size:13px; color:#ccc; margin-bottom:20px; }
.review-item { display:flex; align-items:center; gap:12px; padding:10px 14px; border-radius:var(--radius-sm); border:1px solid var(--group-b-border); background:var(--group-b-bg); margin-bottom:6px; }
.review-item .review-subject { font-size:11px; font-weight:600; color:var(--group-b); text-transform:uppercase; letter-spacing:0.05em; }
.review-item .review-topic { font-size:13px; color:var(--text-primary); flex:1; }
.review-item .review-due { font-size:11px; color:var(--group-a); font-weight:600; }
.modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.4); backdrop-filter:blur(4px); z-index:200; display:flex; align-items:center; justify-content:center; padding:20px; opacity:0; pointer-events:none; transition:opacity 0.2s; }
.modal-overlay.show { opacity:1; pointer-events:all; }
.modal { background:var(--bg-card); border-radius:var(--radius); max-width:500px; width:100%; max-height:80vh; overflow-y:auto; box-shadow:var(--shadow-lg); transform:translateY(10px); transition:transform 0.2s; }
.modal-overlay.show .modal { transform:translateY(0); }
.modal-header { padding:20px 24px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
.modal-title { font-size:16px; font-weight:600; }
.modal-close { width:32px;height:32px; border:none; background:var(--bg); border-radius:var(--radius-xs); cursor:pointer; color:var(--text-secondary); display:flex; align-items:center; justify-content:center; font-size:18px; }
.modal-close:hover { background:var(--bg-hover); }
.modal-body { padding:20px 24px; }
.modal-body textarea { width:100%; min-height:120px; padding:12px; border:1px solid var(--border); border-radius:var(--radius-sm); font-family:var(--font-body); font-size:13.5px; resize:vertical; color:var(--text-primary); }
.modal-body textarea:focus { outline:none; border-color:var(--accent); }
.modal-footer { padding:16px 24px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:8px; }
.btn { padding:8px 16px; border-radius:var(--radius-xs); font-size:13px; font-weight:600; font-family:var(--font-body); cursor:pointer; transition:all 0.15s; border:1px solid transparent; display:inline-flex; align-items:center; gap:6px; }
.btn-primary { background:var(--accent); color:white; }
.btn-primary:hover { background:#4338CA; }
.btn-secondary { background:var(--bg); border-color:var(--border); color:var(--text-secondary); }
.btn-secondary:hover { background:var(--bg-hover); color:var(--text-primary); }
.btn-danger { background:#FEF2F2; border-color:var(--group-a-border); color:var(--group-a); }
.btn-danger:hover { background:#FEE2E2; }
.btn-sm { padding:5px 10px; font-size:12px; }
.toast-container { position:fixed; bottom:24px; right:24px; z-index:300; display:flex; flex-direction:column; gap:8px; }
.toast { padding:12px 20px; background:var(--text-primary); color:white; border-radius:var(--radius-sm); font-size:13px; font-weight:500; box-shadow:var(--shadow-lg); animation:toastIn 0.3s ease; }
.toast.out { animation:toastOut 0.3s ease forwards; }
@keyframes toastIn { from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)} }
@keyframes toastOut { to{opacity:0;transform:translateY(10px)} }
.empty-state { text-align:center; padding:40px; color:var(--text-muted); }
.empty-state svg { width:48px;height:48px; margin-bottom:12px; opacity:0.4; }
.empty-state p { font-size:14px; }
.filter-chips { display:flex; gap:6px; margin-bottom:16px; flex-wrap:wrap; }
.chip { padding:5px 14px; border-radius:20px; font-size:12px; font-weight:600; border:1px solid var(--border); background:var(--bg-card); color:var(--text-secondary); cursor:pointer; transition:all 0.15s; }
.chip:hover { background:var(--bg-hover); }
.chip.active-a { background:var(--group-a-bg); color:var(--group-a); border-color:var(--group-a-border); }
.chip.active-b { background:var(--group-b-bg); color:var(--group-b); border-color:var(--group-b-border); }
.chip.active-c { background:var(--group-c-bg); color:var(--group-c); border-color:var(--group-c-border); }
.chip.active-all { background:var(--accent-light); color:var(--accent); border-color:rgba(79,70,229,0.2); }
.month-counter { display:inline-flex; align-items:center; gap:6px; padding:8px 16px; background:var(--accent-light); border-radius:20px; font-size:13px; font-weight:600; color:var(--accent); margin-bottom:16px; }
#importInput { display:none; }
.hidden { display:none !important; }
/* ‚ïê‚ïê‚ïê NEW MODULE STYLES v2 ‚ïê‚ïê‚ïê */
.form-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.form-group { display:flex; flex-direction:column; gap:5px; }
.form-group.full { grid-column:1/-1; }
.form-group label { font-size:12px; font-weight:600; color:var(--text-secondary); text-transform:uppercase; letter-spacing:0.04em; }
.form-group input,.form-group select,.form-group textarea { padding:8px 12px; border:1px solid var(--border); border-radius:var(--radius-xs); font-size:13.5px; font-family:var(--font-body); color:var(--text-primary); background:var(--bg-card); transition:border-color 0.15s; }
.form-group input:focus,.form-group select:focus,.form-group textarea:focus { outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(79,70,229,0.08); }
.form-group textarea { resize:vertical; min-height:56px; }
.form-group .form-hint { font-size:11px; color:var(--text-muted); }
.form-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:16px; }
.entry-item { display:flex; align-items:center; gap:12px; padding:12px 16px; border-bottom:1px solid var(--border-light); transition:background 0.1s; }
.entry-item:last-child { border-bottom:none; }
.entry-item:hover { background:var(--bg-hover); }
.entry-date { font-size:12px; font-weight:600; color:var(--text-muted); min-width:52px; white-space:nowrap; }
.entry-subject { font-size:12px; font-weight:600; color:var(--accent); min-width:80px; max-width:120px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.entry-details { flex:1; display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.entry-stat { font-size:13px; color:var(--text-secondary); }
.entry-stat strong { color:var(--text-primary); font-weight:600; }
.entry-pct { font-size:12px; font-weight:700; padding:2px 8px; border-radius:10px; }
.entry-pct.good { background:var(--group-c-bg); color:var(--status-done); }
.entry-pct.ok { background:var(--group-b-bg); color:var(--group-b); }
.entry-pct.bad { background:var(--group-a-bg); color:var(--group-a); }
.entry-tags { display:flex; gap:4px; flex-wrap:wrap; }
.entry-tag { font-size:10px; font-weight:600; padding:1px 7px; border-radius:8px; background:var(--accent-light); color:var(--accent); }
.entry-actions { display:flex; gap:4px; flex-shrink:0; }
.entry-actions button { width:28px; height:28px; border:1px solid var(--border); border-radius:var(--radius-xs); background:var(--bg-card); cursor:pointer; font-size:13px; display:flex; align-items:center; justify-content:center; transition:all 0.12s; color:var(--text-muted); }
.entry-actions button:hover { background:var(--bg-hover); color:var(--text-primary); }
.entry-actions button.del:hover { background:var(--group-a-bg); color:var(--group-a); }
.summary-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:14px; margin-bottom:24px; }
.summary-mini { padding:14px 16px; border-radius:var(--radius); border:1px solid var(--border); background:var(--bg-card); }
.summary-mini .sm-label { font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.06em; font-weight:600; margin-bottom:4px; }
.summary-mini .sm-value { font-family:var(--font-display); font-size:22px; font-weight:700; }
.summary-mini .sm-sub { font-size:11px; color:var(--text-secondary); margin-top:2px; }
.hbar-row { display:flex; align-items:center; gap:10px; padding:6px 0; }
.hbar-label { font-size:12px; font-weight:500; color:var(--text-secondary); min-width:110px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.hbar-track { flex:1; height:10px; background:var(--border-light); border-radius:5px; overflow:hidden; }
.hbar-fill { height:100%; border-radius:5px; transition:width 0.3s; }
.hbar-value { font-size:12px; font-weight:600; color:var(--text-primary); min-width:52px; text-align:right; }
.quick-add-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:24px; }
.quick-add-card { padding:16px 20px; border:1px dashed var(--border); border-radius:var(--radius); background:var(--bg-card); cursor:pointer; transition:all 0.15s; display:flex; align-items:center; gap:14px; }
.quick-add-card:hover { border-color:var(--accent); background:var(--accent-light); }
.quick-add-icon { width:40px;height:40px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; }
.quick-add-card .qa-title { font-size:14px; font-weight:600; color:var(--text-primary); }
.quick-add-card .qa-sub { font-size:12px; color:var(--text-secondary); }
.subj-summary-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:14px; margin-bottom:24px; }
.subj-summary-card { border:1px solid var(--border); border-radius:var(--radius); padding:16px; background:var(--bg-card); }
.subj-summary-card .ssc-head { display:flex; align-items:center; gap:8px; margin-bottom:10px; }
.subj-summary-card .ssc-name { font-size:13px; font-weight:600; flex:1; }
.subj-summary-card .ssc-row { display:flex; justify-content:space-between; font-size:12px; color:var(--text-secondary); padding:2px 0; }
.subj-summary-card .ssc-row strong { color:var(--text-primary); }
.subj-summary-card .ssc-tags { margin-top:8px; padding-top:8px; border-top:1px solid var(--border-light); }
.subj-summary-card .ssc-tags-title { font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.06em; font-weight:600; margin-bottom:4px; }
.confirm-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.35); backdrop-filter:blur(3px); z-index:250; display:flex; align-items:center; justify-content:center; padding:20px; opacity:0; pointer-events:none; transition:opacity 0.15s; }
.confirm-overlay.show { opacity:1; pointer-events:all; }
.confirm-box { background:var(--bg-card); border-radius:var(--radius); padding:24px; max-width:380px; width:100%; box-shadow:var(--shadow-lg); text-align:center; }
.confirm-box p { font-size:14px; color:var(--text-primary); margin-bottom:20px; line-height:1.5; }
.confirm-box .confirm-btns { display:flex; gap:8px; justify-content:center; }
@media (max-width:900px) {
  .sidebar { transform:translateX(-100%); }
  .sidebar.open { transform:translateX(0); box-shadow:var(--shadow-lg); }
  .main-content { margin-left:0; }
  .menu-toggle { display:flex; }
  .section-grid,.quick-add-grid { grid-template-columns:1fr; }
  .page-content { padding:20px 16px 60px; }
  .top-bar { padding:12px 16px; }
  .form-grid { grid-template-columns:1fr; }
}
@media (max-width:600px) {
  .stats-grid { grid-template-columns:1fr 1fr; }
  .summary-row { grid-template-columns:1fr 1fr; }
  .subj-summary-grid { grid-template-columns:1fr; }
}
@keyframes fadeIn { from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)} }
.fade-in { animation:fadeIn 0.3s ease both; }
</style>
</head>
<body>
<div class="app-shell" id="appShell">
  <aside class="sidebar" id="sidebar" role="navigation" aria-label="Menu principal">
    <div class="sidebar-header">
      <div class="sidebar-logo">TJ<span>‚Äî</span>SC</div>
      <div class="sidebar-sub">T√©cnico Judici√°rio ¬∑ Estudos</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">Principal</div>
      <div class="nav-item active" data-view="dashboard" tabindex="0" role="button" aria-current="page">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Dashboard
      </div>
      <div class="nav-item" data-view="materias" tabindex="0" role="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
        Mat√©rias
      </div>
      <div class="nav-item" data-view="questoes" tabindex="0" role="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        Quest√µes
      </div>
      <div class="nav-item" data-view="tempo" tabindex="0" role="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        Tempo
      </div>
      <div class="nav-item" data-view="metas" tabindex="0" role="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
        Metas Semanais
      </div>
      <div class="nav-item" data-view="redacao" tabindex="0" role="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
        Reda√ß√£o
      </div>
      <div class="nav-item" data-view="leiseca" tabindex="0" role="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        Lei Seca <span class="nav-badge">A</span>
      </div>
      <div class="nav-section-label">Revis√£o</div>
      <div class="nav-item" data-view="revisao" tabindex="0" role="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
        Fila de Revis√£o
      </div>
    </nav>
    <div class="sidebar-footer">
      <button onclick="exportData()" aria-label="Exportar dados">üì§ Exportar</button>
      <button onclick="document.getElementById('importInput').click()" aria-label="Importar dados">üì• Importar</button>
      <button onclick="showConfirm('Resetar todo o progresso? Esta a√ß√£o n√£o pode ser desfeita.',confirmReset)" aria-label="Resetar progresso">üîÑ Reset</button>
    </div>
    <input type="file" id="importInput" accept=".json" onchange="importData(event)" aria-hidden="true">
  </aside>
  <div class="main-content">
    <div class="top-bar">
      <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Abrir menu"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
      <div class="search-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="globalSearch" placeholder="Buscar t√≥pico, mat√©ria‚Ä¶ ( / )" oninput="handleSearch(this.value)" aria-label="Busca global">
      </div>
      <div class="top-bar-right">
        <button class="btn btn-sm btn-secondary" onclick="markVisibleDone()" aria-label="Concluir vis√≠veis">‚úì Concluir vis√≠veis</button>
      </div>
    </div>
    <div class="page-content" id="pageContent"></div>
  </div>
</div>
<div class="modal-overlay" id="notesModal" role="dialog" aria-modal="true" aria-label="Anota√ß√µes">
  <div class="modal">
    <div class="modal-header"><span class="modal-title" id="notesModalTitle">Anota√ß√µes</span><button class="modal-close" onclick="closeNotesModal()" aria-label="Fechar">√ó</button></div>
    <div class="modal-body"><textarea id="notesModalText" placeholder="Escreva suas anota√ß√µes aqui..." aria-label="Texto da anota√ß√£o"></textarea></div>
    <div class="modal-footer"><button class="btn btn-secondary" onclick="closeNotesModal()">Cancelar</button><button class="btn btn-primary" onclick="saveNotes()">üíæ Salvar</button></div>
  </div>
</div>
<div class="confirm-overlay" id="confirmOverlay" role="alertdialog" aria-modal="true" aria-label="Confirma√ß√£o">
  <div class="confirm-box"><p id="confirmMsg"></p><div class="confirm-btns"><button class="btn btn-secondary" onclick="hideConfirm()">Cancelar</button><button class="btn btn-danger" id="confirmYes">Confirmar</button></div></div>
</div>
<div class="toast-container" id="toastContainer" aria-live="polite"></div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEED DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SEED_DATA=[
{id:"port",name:"L√≠ngua Portuguesa (FGV)",group:"A",priorityRank:1,weightLabel:"~25% da prova",weeklyGoal:10,weeklyGoalAuto:10,topics:["Interpreta√ß√£o e compreens√£o de textos","Organiza√ß√£o estrutural dos textos","Marcas de textualidade: coes√£o, coer√™ncia e intertextualidade","Modos de organiza√ß√£o discursiva: descri√ß√£o","Modos de organiza√ß√£o discursiva: narra√ß√£o","Modos de organiza√ß√£o discursiva: exposi√ß√£o","Modos de organiza√ß√£o discursiva: argumenta√ß√£o","Modos de organiza√ß√£o discursiva: injun√ß√£o","Tipos textuais: informativo","Tipos textuais: publicit√°rio","Tipos textuais: propagand√≠stico","Tipos textuais: normativo","Tipos textuais: did√°tico","Tipos textuais: divinat√≥rio","Textos liter√°rios e n√£o liter√°rios","Tipologia da frase portuguesa","Estrutura da frase: deslocamento","Estrutura da frase: substitui√ß√£o","Estrutura da frase: modifica√ß√£o","Estrutura da frase: corre√ß√£o","Problemas estruturais das frases","Norma culta","Pontua√ß√£o e sinais gr√°ficos","Organiza√ß√£o sint√°tica: termos","Organiza√ß√£o sint√°tica: ora√ß√µes","Ordem direta e inversa","Tipos de discurso","Registros de linguagem","Fun√ß√µes da linguagem","Elementos dos atos de comunica√ß√£o","Estrutura e forma√ß√£o de palavras","Formas de abrevia√ß√£o","Classes de palavras ‚Äî vis√£o geral","Aspectos morfol√≥gicos das classes","Aspectos sint√°ticos das classes","Aspectos sem√¢nticos das classes","Modalizadores","Sem√¢ntica: sentido pr√≥prio e figurado","Sin√¥nimos, ant√¥nimos, par√¥nimos, hiper√¥nimos","Polissemia e ambiguidade","Dicion√°rios e organiza√ß√£o de verbetes","Vocabul√°rio: neologismos, arca√≠smos, estrangeirismos, latinismos","Ortografia","Acentua√ß√£o","Crase"]},
{id:"leg",name:"Legisla√ß√£o Interna TJ-SC",group:"A",priorityRank:2,weightLabel:"~25% da prova",weeklyGoal:8,weeklyGoalAuto:8,topics:["Estatuto servidores SC ‚Äî Lei 6.745/85","Regimento Interno TJSC","C√≥digo de √âtica ‚Äî Resolu√ß√£o 22/2021","Regime disciplinar ‚Äî LC 639/2015","C√≥digo de Organiza√ß√£o Judici√°ria ‚Äî Lei 5.624/79","C√≥digo de Normas CGJ"]},
{id:"pcivil",name:"Processo Civil",group:"B",priorityRank:3,weightLabel:"Base jur√≠dica",weeklyGoal:5,weeklyGoalAuto:5,topics:["Princ√≠pios do processo","Devido processo legal","Contradit√≥rio e ampla defesa","Juiz natural","Pressupostos processuais","Jurisdi√ß√£o","Princ√≠pio da in√©rcia","A√ß√£o ‚Äî conceito","Condi√ß√µes da a√ß√£o","Elementos da a√ß√£o","Classifica√ß√£o da a√ß√£o","Coopera√ß√£o internacional ‚Äî disposi√ß√µes gerais","Aux√≠lio direto","Carta rogat√≥ria","Compet√™ncia ‚Äî disposi√ß√µes gerais"]},
{id:"ppenal",name:"Processo Penal",group:"B",priorityRank:4,weightLabel:"Base jur√≠dica",weeklyGoal:5,weeklyGoalAuto:5,topics:["Disposi√ß√µes preliminares CPP","Inqu√©rito policial","A√ß√£o penal","Sujeitos processuais","Auxiliares da justi√ßa","Cita√ß√µes e intima√ß√µes","Senten√ßa","Processo comum","Instru√ß√£o criminal","Tribunal do j√∫ri ‚Äî vis√£o geral","Acusa√ß√£o e instru√ß√£o preliminar","Pron√∫ncia, impron√∫ncia, absolvi√ß√£o sum√°ria","Prepara√ß√£o para plen√°rio","Jurados ‚Äî alistamento","Desaforamento","Organiza√ß√£o da pauta","Sorteio e convoca√ß√£o","Fun√ß√£o do jurado","Forma√ß√£o do conselho de senten√ßa","Sess√µes do j√∫ri","Instru√ß√£o em plen√°rio","Debates","Question√°rio e vota√ß√£o","Senten√ßa no j√∫ri","Ata dos trabalhos","Atribui√ß√µes do presidente","Pris√£o e liberdade provis√≥ria","Crimes de responsabilidade de funcion√°rios","Habeas corpus"]},
{id:"dadm",name:"Direito Administrativo",group:"B",priorityRank:5,weightLabel:"Base jur√≠dica",weeklyGoal:4,weeklyGoalAuto:4,topics:["Organiza√ß√£o administrativa","Administra√ß√£o direta e indireta","Descentraliza√ß√£o","Desconcentra√ß√£o","Princ√≠pios administrativos","√ìrg√£os p√∫blicos","Agentes p√∫blicos","Poderes administrativos","Ato administrativo","Licita√ß√µes","Contratos","Lei 14.133"]},
{id:"const",name:"Constitucional",group:"C",priorityRank:6,weightLabel:"Complementar",weeklyGoal:3,weeklyGoalAuto:3,topics:["Constitui√ß√£o ‚Äî conceito e classifica√ß√µes","Princ√≠pios fundamentais","Direitos fundamentais","Direitos sociais","Nacionalidade","Direitos pol√≠ticos","Organiza√ß√£o pol√≠tico-administrativa","Administra√ß√£o p√∫blica","Servidores p√∫blicos","Poder Judici√°rio","CNJ","Fun√ß√µes essenciais √† justi√ßa"]},
{id:"civil",name:"Civil",group:"C",priorityRank:7,weightLabel:"Complementar",weeklyGoal:3,weeklyGoalAuto:3,topics:["LINDB ‚Äî vig√™ncia","Aplica√ß√£o e interpreta√ß√£o","Conflito no tempo","Efic√°cia no espa√ßo","Pessoas naturais","Personalidade e capacidade","Nome, estado e domic√≠lio","Direitos da personalidade","Pessoas jur√≠dicas","Associa√ß√µes e funda√ß√µes","Bens","Fatos jur√≠dicos","Neg√≥cio jur√≠dico","Atos l√≠citos","Atos il√≠citos"]},
{id:"penal",name:"Penal",group:"C",priorityRank:8,weightLabel:"Complementar",weeklyGoal:3,weeklyGoalAuto:3,topics:["Aplica√ß√£o da lei penal","Legalidade e anterioridade","Lei penal no tempo","Lei penal no espa√ßo","Tempo e lugar do crime","Contagem de prazo","Interpreta√ß√£o","Analogia","Irretroatividade","Teoria do crime","Tipo penal objetivo","Tipo penal subjetivo","Ilicitude","Culpabilidade","Crimes contra pessoa","Crimes contra patrim√¥nio","Crimes contra administra√ß√£o p√∫blica","Crimes hediondos","Abuso de autoridade","ECA"]},
{id:"red",name:"Reda√ß√£o",group:"C",priorityRank:9,weightLabel:"Estrat√©gica",weeklyGoal:2,weeklyGoalAuto:2,topics:["Estrutura dissertativa","Temas atuais","√âtica no servi√ßo p√∫blico","Tecnologia e justi√ßa","Sustentabilidade","Desigualdade social"]}
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const STORAGE_KEY="tjsc_study_v1",REDACAO_KEY="tjsc_redacao_v1",METAS_KEY="tjsc_metas_v1";
let state={schemaVersion:2,subjects:[],questionEntries:[],studyEntries:[],settings:{studyWeekMode:"rolling7"}};
let redacaoState={themes:[],monthCount:0,monthLabel:""};
let metasState={totalWeekly:20,groups:{A:50,B:30,C:20}};
let currentView="dashboard",currentNotesTopicId=null,searchQuery="",groupFilter="all";
let editingQuestionId=null,editingStudyId=null;
let qFilter={range:"all",subjectId:"",difficulty:""};
let tFilter={range:"all",subjectId:""};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PURE UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,8);}
function getDateKey(d){if(typeof d==='string')d=new Date(d);return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');}
function todayKey(){return getDateKey(new Date());}
function isWithinRollingDays(dateStr,n){const t=new Date();t.setHours(0,0,0,0);const d=new Date(dateStr);d.setHours(0,0,0,0);const diff=(t-d)/864e5;return diff>=0&&diff<n;}
function filterByRange(entries,range){
  if(range==='today')return entries.filter(e=>e.date===todayKey());
  if(range==='7')return entries.filter(e=>isWithinRollingDays(e.date,7));
  if(range==='30')return entries.filter(e=>isWithinRollingDays(e.date,30));
  return entries;
}
function aggregateQuestions(entries,filter){
  let f=[...entries];
  if(filter.range&&filter.range!=='all')f=filterByRange(f,filter.range);
  if(filter.subjectId)f=f.filter(e=>e.subjectId===filter.subjectId);
  if(filter.difficulty)f=f.filter(e=>e.difficulty===filter.difficulty);
  const bySubject={};let totals={total:0,correct:0,wrong:0};
  f.forEach(e=>{totals.total+=e.total;totals.correct+=e.correct;totals.wrong+=e.wrong;
    if(!bySubject[e.subjectId])bySubject[e.subjectId]={total:0,correct:0,wrong:0,tags:{}};
    const b=bySubject[e.subjectId];b.total+=e.total;b.correct+=e.correct;b.wrong+=e.wrong;
    (e.tags||[]).forEach(tag=>{const t=tag.trim().toLowerCase();if(t)b.tags[t]=(b.tags[t]||0)+1;});
  });
  totals.pct=totals.total>0?Math.round(totals.correct/totals.total*100):0;
  return{bySubject,totals,filtered:f};
}
function aggregateStudy(entries,filter){
  let f=[...entries];
  if(filter.range&&filter.range!=='all')f=filterByRange(f,filter.range);
  if(filter.subjectId)f=f.filter(e=>e.subjectId===filter.subjectId);
  const bySubjectMinutes={};let totalMinutes=0;
  f.forEach(e=>{totalMinutes+=e.minutes;bySubjectMinutes[e.subjectId]=(bySubjectMinutes[e.subjectId]||0)+e.minutes;});
  return{bySubjectMinutes,totalMinutes,filtered:f};
}
function formatMinutes(m){if(!m||m<=0)return"0min";const h=Math.floor(m/60),min=m%60;if(h===0)return min+"min";return min>0?h+"h "+min+"min":h+"h";}
function formatHHMM(m){if(!m||m<=0)return"00:00";return String(Math.floor(m/60)).padStart(2,'0')+':'+String(m%60).padStart(2,'0');}
function pct(d,t){return t===0?0:Math.round(d/t*100);}
function groupColor(g){return g==='A'?'group-a':g==='B'?'group-b':'group-c';}
function groupEmoji(g){return g==='A'?'üî¥':g==='B'?'üü°':'üü¢';}
function statusClass(s){return s==='Conclu√≠do'?'s-done':s==='Em andamento'?'s-progress':s==='Revisar'?'s-review':'';}
function daysAgo(ds){if(!ds)return Infinity;return Math.floor((Date.now()-new Date(ds).getTime())/864e5);}
function getSubjectName(id){const s=state.subjects.find(x=>x.id===id);return s?s.name:id;}
function getSubjectShort(id){const n=getSubjectName(id);return n.length<=16?n:n.slice(0,14)+'‚Ä¶';}
function pctClass(p){return p>=70?'good':p>=50?'ok':'bad';}
function escHtml(s){if(!s)return'';return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function subjectOptions(sel){return state.subjects.sort((a,b)=>a.priorityRank-b.priorityRank).map(s=>'<option value="'+s.id+'"'+(sel===s.id?' selected':'')+'>'+s.name+'</option>').join('');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE INIT / MIGRATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildDefaultSubject(seed){return{...seed,topics:seed.topics.map((text,i)=>({id:seed.id+'__'+(i+1),number:i+1,text,status:"N√£o iniciado",updatedAt:null,notes:"",reviewDueAt:null}))};}

function mergeSeedWithExisting(saved){
  const map={};
  if(saved&&saved.subjects){saved.subjects.forEach(s=>{const tMap={};s.topics.forEach(t=>{tMap[t.id]=t;});map[s.id]={...s,topicMap:tMap};});}
  return SEED_DATA.map(seed=>{const existing=map[seed.id];const base=buildDefaultSubject(seed);if(!existing)return base;
    base.weeklyGoal=existing.weeklyGoal??seed.weeklyGoal;
    base.topics=base.topics.map(t=>{const et=existing.topicMap?.[t.id];if(!et)return t;return{...t,status:et.status,updatedAt:et.updatedAt,notes:et.notes||"",reviewDueAt:et.reviewDueAt};});
    return base;});
}

function migrateState(raw){
  if(!raw.questionEntries)raw.questionEntries=[];
  if(!raw.studyEntries)raw.studyEntries=[];
  if(!raw.settings)raw.settings={};
  if(!raw.settings.studyWeekMode)raw.settings.studyWeekMode="rolling7";
  raw.schemaVersion=2;return raw;
}

function loadState(){
  try{const raw=localStorage.getItem(STORAGE_KEY);const saved=raw?JSON.parse(raw):null;
    if(saved){migrateState(saved);state.subjects=mergeSeedWithExisting(saved);state.questionEntries=saved.questionEntries||[];state.studyEntries=saved.studyEntries||[];state.settings=saved.settings||{studyWeekMode:"rolling7"};}
    else{state.subjects=SEED_DATA.map(buildDefaultSubject);}state.schemaVersion=2;
  }catch(e){state.subjects=SEED_DATA.map(buildDefaultSubject);}
}
function saveState(){localStorage.setItem(STORAGE_KEY,JSON.stringify(state));}

function loadRedacao(){
  try{const raw=localStorage.getItem(REDACAO_KEY);if(raw){const saved=JSON.parse(raw);redacaoState={...redacaoState,...saved};}
    const rs=SEED_DATA.find(s=>s.id==="red");if(rs){const eIds=new Set(redacaoState.themes.map(t=>t.id));rs.topics.forEach((text,i)=>{const id='red_theme_'+(i+1);if(!eIds.has(id))redacaoState.themes.push({id,text,estrutura:false,tese:false,argumentos:false,conectivos:false,notes:""});});}
    const now=new Date();const ml=now.getFullYear()+'-'+now.getMonth();if(redacaoState.monthLabel!==ml){redacaoState.monthCount=0;redacaoState.monthLabel=ml;}
  }catch(e){const rs=SEED_DATA.find(s=>s.id==="red");redacaoState.themes=(rs?.topics||[]).map((text,i)=>({id:'red_theme_'+(i+1),text,estrutura:false,tese:false,argumentos:false,conectivos:false,notes:""}));const now=new Date();redacaoState.monthLabel=now.getFullYear()+'-'+now.getMonth();}
}
function saveRedacao(){localStorage.setItem(REDACAO_KEY,JSON.stringify(redacaoState));}
function loadMetas(){try{const r=localStorage.getItem(METAS_KEY);if(r)metasState={...metasState,...JSON.parse(r)};}catch(e){}}
function saveMetas(){localStorage.setItem(METAS_KEY,JSON.stringify(metasState));}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setupNav(){document.querySelectorAll('.nav-item[data-view]').forEach(el=>{el.addEventListener('click',()=>navigateTo(el.dataset.view));el.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();navigateTo(el.dataset.view);}});});}
function setupKeyboard(){document.addEventListener('keydown',e=>{if(e.key==='/'&&!['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName)){e.preventDefault();document.getElementById('globalSearch').focus();}if(e.key==='Escape'){closeNotesModal();hideConfirm();document.getElementById('sidebar').classList.remove('open');}});}

function navigateTo(view){
  currentView=view;searchQuery="";document.getElementById('globalSearch').value="";editingQuestionId=null;editingStudyId=null;
  document.querySelectorAll('.nav-item').forEach(n=>{n.classList.remove('active');n.removeAttribute('aria-current');});
  const el=document.querySelector('.nav-item[data-view="'+view+'"]');if(el){el.classList.add('active');el.setAttribute('aria-current','page');}
  document.getElementById('sidebar').classList.remove('open');renderView();window.scrollTo(0,0);
}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');}

function renderView(){
  const pc=document.getElementById('pageContent');
  switch(currentView){
    case'dashboard':pc.innerHTML=renderDashboard();break;
    case'materias':pc.innerHTML=renderMaterias();break;
    case'questoes':pc.innerHTML=renderQuestoes();break;
    case'tempo':pc.innerHTML=renderTempo();break;
    case'metas':pc.innerHTML=renderMetas();break;
    case'redacao':pc.innerHTML=renderRedacao();break;
    case'leiseca':pc.innerHTML=renderLeiSeca();break;
    case'revisao':pc.innerHTML=renderRevisao();break;
    default:pc.innerHTML=renderDashboard();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOPIC HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getGroupSubjects(g){return state.subjects.filter(s=>s.group===g);}
function getAllTopics(){return state.subjects.flatMap(s=>s.topics.map(t=>({...t,subjectId:s.id,subjectName:s.name,group:s.group})));}
function countByStatus(topics,status){return topics.filter(t=>t.status===status).length;}
function getReviewQueue(){const now=Date.now();return getAllTopics().filter(t=>{if(t.status!=='Revisar')return false;if(!t.reviewDueAt)return true;return new Date(t.reviewDueAt).getTime()<=now;}).sort((a,b)=>{const ga=a.group==='A'?0:a.group==='B'?1:2,gb=b.group==='A'?0:b.group==='B'?1:2;return ga-gb||(new Date(a.reviewDueAt||0)-new Date(b.reviewDueAt||0));});}
function getNextToDo(){return getAllTopics().filter(t=>t.status==='N√£o iniciado').sort((a,b)=>{const ga=a.group==='A'?0:a.group==='B'?1:2,gb=b.group==='A'?0:b.group==='B'?1:2;return ga-gb;}).slice(0,8);}
function getWeekDone(g){const now=new Date(),ws=new Date(now);ws.setDate(now.getDate()-now.getDay());ws.setHours(0,0,0,0);return getAllTopics().filter(t=>{if(g&&t.group!==g)return false;if(t.status!=='Conclu√≠do')return false;if(!t.updatedAt)return false;return new Date(t.updatedAt)>=ws;}).length;}
function getSubjectWeekDone(sid){const now=new Date(),ws=new Date(now);ws.setDate(now.getDate()-now.getDay());ws.setHours(0,0,0,0);const sub=state.subjects.find(s=>s.id===sid);if(!sub)return 0;return sub.topics.filter(t=>t.status==='Conclu√≠do'&&t.updatedAt&&new Date(t.updatedAt)>=ws).length;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard(){
  const all=getAllTopics(),total=all.length,done=countByStatus(all,'Conclu√≠do'),review=getReviewQueue().length;
  const gStats=['A','B','C'].map(g=>{const gT=all.filter(t=>t.group===g),gD=countByStatus(gT,'Conclu√≠do');return{g,total:gT.length,done:gD,pct:pct(gD,gT.length)};});
  const nextToDo=getNextToDo(),reviewQ=getReviewQueue().slice(0,5);
  const sToday=aggregateStudy(state.studyEntries,{range:'today'}),s7=aggregateStudy(state.studyEntries,{range:'7'}),q7=aggregateQuestions(state.questionEntries,{range:'7'});
  const top3T=Object.entries(s7.bySubjectMinutes).sort((a,b)=>b[1]-a[1]).slice(0,3);
  const top3Q=Object.entries(q7.bySubject).sort((a,b)=>b[1].total-a[1].total).slice(0,3);

  return '<h1 class="page-title fade-in">Dashboard Estrat√©gico</h1><p class="page-subtitle fade-in">Vis√£o geral do seu progresso para o concurso TJ-SC</p>'+
  '<div class="quick-add-grid fade-in"><div class="quick-add-card" onclick="navigateTo(\'questoes\')" onkeydown="if(event.key===\'Enter\')navigateTo(\'questoes\')" tabindex="0" role="button" aria-label="Registrar quest√µes"><div class="quick-add-icon" style="background:var(--accent-light);color:var(--accent)">‚ùì</div><div><div class="qa-title">Registrar Quest√µes</div><div class="qa-sub">Lan√ßar acertos e erros por mat√©ria</div></div></div>'+
  '<div class="quick-add-card" onclick="navigateTo(\'tempo\')" onkeydown="if(event.key===\'Enter\')navigateTo(\'tempo\')" tabindex="0" role="button" aria-label="Registrar tempo de estudo"><div class="quick-add-icon" style="background:#EFF6FF;color:var(--status-progress)">‚è±Ô∏è</div><div><div class="qa-title">Registrar Tempo</div><div class="qa-sub">Controlar horas de estudo por mat√©ria</div></div></div></div>'+
  '<div class="stats-grid"><div class="card stat-card general fade-in"><div class="stat-accent"></div><div class="stat-label" style="margin-top:8px">Progresso Geral</div><div class="stat-number">'+pct(done,total)+'%</div><div class="stat-sub">'+done+' de '+total+' t√≥picos conclu√≠dos</div><div class="progress-bar"><div class="progress-fill general" style="width:'+pct(done,total)+'%"></div></div></div>'+
  gStats.map(gs=>'<div class="card stat-card '+groupColor(gs.g)+' fade-in"><div class="stat-accent"></div><div class="stat-label" style="margin-top:8px">'+groupEmoji(gs.g)+' Grupo '+gs.g+'</div><div class="stat-number">'+gs.pct+'%</div><div class="stat-sub">'+gs.done+'/'+gs.total+' t√≥picos</div><div class="progress-bar"><div class="progress-fill '+groupColor(gs.g)+'" style="width:'+gs.pct+'%"></div></div></div>').join('')+'</div>'+
  '<div class="summary-row fade-in"><div class="summary-mini" style="border-left:3px solid var(--status-progress)"><div class="sm-label">‚è±Ô∏è Tempo Hoje</div><div class="sm-value">'+formatHHMM(sToday.totalMinutes)+'</div><div class="sm-sub">'+formatMinutes(sToday.totalMinutes)+'</div></div>'+
  '<div class="summary-mini" style="border-left:3px solid var(--accent)"><div class="sm-label">‚è±Ô∏è Tempo 7 Dias</div><div class="sm-value">'+formatHHMM(s7.totalMinutes)+'</div><div class="sm-sub">'+formatMinutes(s7.totalMinutes)+'</div></div>'+
  '<div class="summary-mini" style="border-left:3px solid var(--group-b)"><div class="sm-label">‚ùì Quest√µes 7 Dias</div><div class="sm-value">'+q7.totals.total+'</div><div class="sm-sub">'+q7.totals.correct+' acertos ¬∑ '+q7.totals.pct+'%</div></div>'+
  '<div class="summary-mini" style="border-left:3px solid var(--status-review)"><div class="sm-label">üîÑ Fila de Revis√£o</div><div class="sm-value">'+review+'</div><div class="sm-sub">t√≥picos pendentes</div></div></div>'+
  (gStats[0].pct<100?'<div class="card fade-in" style="border-left:3px solid var(--group-a);margin-bottom:24px;padding:16px 20px"><div style="display:flex;align-items:center;gap:12px"><span style="font-size:24px">‚ö†Ô∏è</span><div><div style="font-weight:600;font-size:14px">Grupo A precisa de aten√ß√£o ‚Äî '+gStats[0].pct+'% conclu√≠do</div><div style="font-size:13px;color:var(--text-secondary)">Esse grupo representa ~50% da prova. Priorize L√≠ngua Portuguesa e Legisla√ß√£o.</div></div></div></div>':'')+
  (top3T.length>0||top3Q.length>0?'<div class="section-grid fade-in"><div><div class="section-title"><span class="dot" style="background:var(--status-progress)"></span> Top 3 por Tempo (7d)</div>'+
  (top3T.length===0?'<div style="font-size:13px;color:var(--text-muted)">Nenhum registro</div>':top3T.map(function(e,i){return'<div class="hbar-row"><span style="font-size:13px;font-weight:700;color:var(--text-muted);min-width:18px">'+(i+1)+'.</span><span class="hbar-label">'+getSubjectShort(e[0])+'</span><div class="hbar-track"><div class="hbar-fill" style="width:'+pct(e[1],top3T[0][1])+'%;background:var(--status-progress)"></div></div><span class="hbar-value">'+formatMinutes(e[1])+'</span></div>';}).join(''))+
  '</div><div><div class="section-title"><span class="dot" style="background:var(--group-b)"></span> Top 3 por Quest√µes (7d)</div>'+
  (top3Q.length===0?'<div style="font-size:13px;color:var(--text-muted)">Nenhum registro</div>':top3Q.map(function(e,i){var d=e[1];return'<div class="hbar-row"><span style="font-size:13px;font-weight:700;color:var(--text-muted);min-width:18px">'+(i+1)+'.</span><span class="hbar-label">'+getSubjectShort(e[0])+'</span><div class="hbar-track"><div class="hbar-fill" style="width:'+pct(d.total,top3Q[0][1].total)+'%;background:var(--group-b)"></div></div><span class="hbar-value">'+d.total+'q ¬∑ '+(d.total>0?Math.round(d.correct/d.total*100):0)+'%</span></div>';}).join(''))+
  '</div></div>':'')+
  '<div class="section-grid fade-in"><div><div class="section-title"><span class="dot" style="background:var(--accent)"></span> Pr√≥ximos a Estudar</div>'+
  (nextToDo.length===0?'<div class="empty-state"><p>Todos iniciados!</p></div>':'<div class="topic-list">'+nextToDo.map(t=>'<div class="topic-item"><span class="subject-group-tag '+groupColor(t.group)+'">'+t.group+'</span><span class="topic-text" style="font-size:12.5px">'+t.text+'</span><span style="font-size:11px;color:var(--text-muted)">'+t.subjectName.split(' ')[0]+'</span></div>').join('')+'</div>')+
  '</div><div><div class="section-title"><span class="dot" style="background:var(--status-review)"></span> Revis√µes Pendentes</div>'+
  (reviewQ.length===0?'<div class="empty-state"><p>Nenhuma revis√£o pendente</p></div>':reviewQ.map(t=>'<div class="review-item"><div style="flex:1"><div class="review-subject">'+t.subjectName+'</div><div class="review-topic">'+t.text+'</div></div>'+(t.reviewDueAt?'<span class="review-due">'+(daysAgo(t.reviewDueAt)>=0?'Vencida':'Em breve')+'</span>':'<span class="review-due">Sem data</span>')+'</div>').join('')+(reviewQ.length>0?'<div style="margin-top:8px"><button class="btn btn-sm btn-secondary" onclick="navigateTo(\'revisao\')">Ver todas ‚Üí</button></div>':''))+
  '</div></div>'+
  '<div class="section-title fade-in" style="margin-top:8px"><span class="dot" style="background:var(--text-muted)"></span> Progresso por Mat√©ria</div>'+
  '<div class="card fade-in" style="padding:0;overflow:hidden">'+state.subjects.sort((a,b)=>a.priorityRank-b.priorityRank).map(s=>{var sD=countByStatus(s.topics,'Conclu√≠do'),sP=pct(sD,s.topics.length);return'<div style="display:flex;align-items:center;gap:14px;padding:12px 20px;border-bottom:1px solid var(--border-light)"><span class="subject-group-tag '+groupColor(s.group)+'">'+s.group+'</span><span style="flex:1;font-size:13.5px;font-weight:500">'+s.name+'</span><div style="width:120px"><div class="progress-bar" style="height:6px"><div class="progress-fill '+groupColor(s.group)+'" style="width:'+sP+'%"></div></div></div><span style="font-size:13px;font-weight:600;min-width:48px;text-align:right">'+sP+'%</span></div>';}).join('')+'</div>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAT√âRIAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMaterias(){
  var filtered=searchQuery?state.subjects.filter(s=>s.name.toLowerCase().includes(searchQuery)||s.topics.some(t=>t.text.toLowerCase().includes(searchQuery))):(groupFilter!=='all'?state.subjects.filter(s=>s.group===groupFilter):state.subjects);
  var sorted=[...filtered].sort((a,b)=>a.priorityRank-b.priorityRank);
  return '<h1 class="page-title fade-in">Mat√©rias</h1><p class="page-subtitle fade-in">Gerencie seus t√≥picos por disciplina e grupo de prioridade</p>'+
  '<div class="filter-chips fade-in"><span class="chip '+(groupFilter==='all'?'active-all':'')+'" onclick="setGroupFilter(\'all\')" tabindex="0" role="button" onkeydown="if(event.key===\'Enter\')setGroupFilter(\'all\')">Todas</span><span class="chip '+(groupFilter==='A'?'active-a':'')+'" onclick="setGroupFilter(\'A\')" tabindex="0" role="button" onkeydown="if(event.key===\'Enter\')setGroupFilter(\'A\')">üî¥ Grupo A</span><span class="chip '+(groupFilter==='B'?'active-b':'')+'" onclick="setGroupFilter(\'B\')" tabindex="0" role="button" onkeydown="if(event.key===\'Enter\')setGroupFilter(\'B\')">üü° Grupo B</span><span class="chip '+(groupFilter==='C'?'active-c':'')+'" onclick="setGroupFilter(\'C\')" tabindex="0" role="button" onkeydown="if(event.key===\'Enter\')setGroupFilter(\'C\')">üü¢ Grupo C</span></div>'+
  sorted.map(s=>{var sD=countByStatus(s.topics,'Conclu√≠do'),fT=searchQuery?s.topics.filter(t=>t.text.toLowerCase().includes(searchQuery)):s.topics;
    return'<div class="subject-card fade-in"><div class="subject-header" onclick="toggleSubject(\''+s.id+'\',this)" role="button" tabindex="0" aria-expanded="false"><span class="subject-group-tag '+groupColor(s.group)+'">'+s.group+'</span><span class="subject-name">'+s.name+'</span><span style="font-size:11px;color:var(--text-muted)">'+s.weightLabel+'</span><span class="subject-progress-mini">'+sD+'/'+s.topics.length+'</span><svg class="subject-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg></div><div class="subject-body" id="body-'+s.id+'"><div class="topic-list">'+fT.map(t=>renderTopicItem(t,s)).join('')+'</div></div></div>';}).join('');
}

function renderTopicItem(t,s){
  return'<div class="topic-item" data-topic-id="'+t.id+'"><span class="topic-number">'+t.number+'</span><span class="topic-text '+(t.status==='Conclu√≠do'?'done':'')+'">'+t.text+'</span><div class="topic-actions"><select class="status-select '+statusClass(t.status)+'" onchange="changeStatus(\''+s.id+'\',\''+t.id+'\',this.value)" aria-label="Status"><option'+(t.status==='N√£o iniciado'?' selected':'')+'>N√£o iniciado</option><option'+(t.status==='Em andamento'?' selected':'')+'>Em andamento</option><option'+(t.status==='Revisar'?' selected':'')+'>Revisar</option><option'+(t.status==='Conclu√≠do'?' selected':'')+'>Conclu√≠do</option></select><button class="notes-btn '+(t.notes?'has-notes':'')+'" onclick="openNotesModal(\''+s.id+'\',\''+t.id+'\')" aria-label="Anota√ß√µes"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg></button></div></div>';
}

function toggleSubject(id,h){var b=document.getElementById('body-'+id);b.classList.toggle('open');h.classList.toggle('open');h.setAttribute('aria-expanded',b.classList.contains('open'));}
function setGroupFilter(g){groupFilter=g;renderView();}

function changeStatus(sid,tid,ns){
  var sub=state.subjects.find(s=>s.id===sid);if(!sub)return;var t=sub.topics.find(x=>x.id===tid);if(!t)return;
  t.status=ns;t.updatedAt=new Date().toISOString();
  if(ns==='Revisar'){var d=new Date();d.setDate(d.getDate()+7);t.reviewDueAt=d.toISOString();}else{t.reviewDueAt=null;}
  saveState();
  var el=document.querySelector('[data-topic-id="'+tid+'"]');
  if(el){var te=el.querySelector('.topic-text');if(te)te.classList.toggle('done',ns==='Conclu√≠do');var sel=el.querySelector('.status-select');if(sel)sel.className='status-select '+statusClass(ns);}
  toast('T√≥pico ‚Üí '+ns);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// QUEST√ïES MODULE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderQuestoes(){
  var agg=aggregateQuestions(state.questionEntries,qFilter);
  var sorted=[...agg.filtered].sort((a,b)=>b.date.localeCompare(a.date)||b.createdAt.localeCompare(a.createdAt));
  var allAgg=aggregateQuestions(state.questionEntries,{});
  var formTitle=editingQuestionId?'‚úèÔ∏è Editando Lan√ßamento':'‚ûï Novo Lan√ßamento de Quest√µes';
  var cancelBtn=editingQuestionId?'<button class="btn btn-sm btn-secondary" onclick="cancelEditQuestion()">Cancelar</button>':'';
  var saveLabel=editingQuestionId?'Atualizar':'Salvar';

  var summaryHtml=state.subjects.filter(s=>allAgg.bySubject[s.id]).sort((a,b)=>a.priorityRank-b.priorityRank).map(s=>{
    var d=allAgg.bySubject[s.id],p=d.total>0?Math.round(d.correct/d.total*100):0;
    var topTags=Object.entries(d.tags).sort((a,b)=>b[1]-a[1]).slice(0,5);
    return'<div class="subj-summary-card"><div class="ssc-head"><span class="subject-group-tag '+groupColor(s.group)+'">'+s.group+'</span><span class="ssc-name">'+s.name+'</span></div>'+
    '<div class="ssc-row"><span>Total</span><strong>'+d.total+'</strong></div><div class="ssc-row"><span>Acertos</span><strong style="color:var(--status-done)">'+d.correct+'</strong></div><div class="ssc-row"><span>Erros</span><strong style="color:var(--group-a)">'+d.wrong+'</strong></div>'+
    '<div class="ssc-row"><span>% Acerto</span><strong><span class="entry-pct '+pctClass(p)+'">'+p+'%</span></strong></div>'+
    (topTags.length>0?'<div class="ssc-tags"><div class="ssc-tags-title">Erros frequentes (tags)</div><div class="entry-tags">'+topTags.map(function(e){return'<span class="entry-tag">'+e[0]+' ('+e[1]+')</span>';}).join('')+'</div></div>':'')+
    '</div>';}).join('')||'<div style="font-size:13px;color:var(--text-muted);padding:8px 0">Nenhuma quest√£o registrada.</div>';

  var listHtml=sorted.length===0?'<div class="empty-state"><p>Nenhum lan√ßamento encontrado</p></div>':sorted.map(e=>{
    var p=e.total>0?Math.round(e.correct/e.total*100):0;
    var dateDisplay=qFilter.range==='all'?e.date:e.date.slice(5).replace('-','/');
    return'<div class="entry-item"><span class="entry-date">'+dateDisplay+'</span><span class="entry-subject">'+getSubjectShort(e.subjectId)+'</span><div class="entry-details"><span class="entry-stat"><strong>'+e.total+'</strong>q</span><span class="entry-stat" style="color:var(--status-done)">‚úì'+e.correct+'</span><span class="entry-stat" style="color:var(--group-a)">‚úó'+e.wrong+'</span><span class="entry-pct '+pctClass(p)+'">'+p+'%</span><span class="entry-stat" style="font-size:11px;color:var(--text-muted)">'+e.difficulty+'</span>'+
    ((e.tags||[]).length>0?'<div class="entry-tags">'+e.tags.map(t=>'<span class="entry-tag">'+t+'</span>').join('')+'</div>':'')+
    (e.errorNotes?'<span class="entry-stat" style="font-size:11px;color:var(--text-muted);font-style:italic" title="'+escHtml(e.errorNotes)+'">üìù '+escHtml(e.errorNotes.slice(0,40))+(e.errorNotes.length>40?'‚Ä¶':'')+'</span>':'')+
    '</div><div class="entry-actions"><button onclick="editQuestion(\''+e.id+'\')" aria-label="Editar" title="Editar">‚úèÔ∏è</button><button class="del" onclick="showConfirm(\'Excluir este lan√ßamento?\',function(){deleteQuestion(\''+e.id+'\')})" aria-label="Excluir" title="Excluir">üóëÔ∏è</button></div></div>';}).join('');

  var filterChips=['all','today','7','30'].map(r=>'<span class="chip '+(qFilter.range===r?'active-all':'')+'" onclick="setQFilter(\'range\',\''+r+'\')">'+(r==='all'?'Todos':r==='today'?'Hoje':r+' dias')+'</span>').join('');

  return'<h1 class="page-title fade-in">Quest√µes</h1><p class="page-subtitle fade-in">Registre e acompanhe seu desempenho em quest√µes por mat√©ria</p>'+
  '<div class="card fade-in" style="margin-bottom:24px" id="qFormCard"><div class="card-header"><span class="card-title">'+formTitle+'</span>'+cancelBtn+'</div>'+
  '<div class="form-grid"><div class="form-group"><label for="qDate">Data</label><input type="date" id="qDate" value="'+todayKey()+'"></div>'+
  '<div class="form-group"><label for="qSubject">Mat√©ria *</label><select id="qSubject"><option value="">Selecione...</option>'+subjectOptions()+'</select></div>'+
  '<div class="form-group"><label for="qTotal">Total de quest√µes</label><input type="number" id="qTotal" min="0" value="0" oninput="autoCalcWrong()"></div>'+
  '<div class="form-group"><label for="qCorrect">Acertos</label><input type="number" id="qCorrect" min="0" value="0" oninput="autoCalcWrong()"></div>'+
  '<div class="form-group"><label for="qWrong">Erros</label><input type="number" id="qWrong" min="0" value="0"><span class="form-hint">Auto-calculado, edit√°vel</span></div>'+
  '<div class="form-group"><label for="qDiff">Dificuldade</label><select id="qDiff"><option value="F√°cil">F√°cil</option><option value="M√©dia" selected>M√©dia</option><option value="Dif√≠cil">Dif√≠cil</option></select></div>'+
  '<div class="form-group full"><label for="qTags">Tags (v√≠rgula)</label><input type="text" id="qTags" placeholder="ex: crase, reg√™ncia"></div>'+
  '<div class="form-group full"><label for="qNotes">Notas de erros</label><textarea id="qNotes" rows="2" placeholder="Observa√ß√µes..."></textarea></div></div>'+
  '<div class="form-actions"><button class="btn btn-primary" onclick="saveQuestion()">üíæ '+saveLabel+'</button></div></div>'+
  '<div class="section-title fade-in"><span class="dot" style="background:var(--accent)"></span> Resumo por Mat√©ria</div><div class="subj-summary-grid fade-in">'+summaryHtml+'</div>'+
  '<div class="section-title fade-in"><span class="dot" style="background:var(--group-b)"></span> Lan√ßamentos</div>'+
  '<div class="card fade-in" style="padding:12px 16px;margin-bottom:12px"><div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center"><div class="filter-chips" style="margin-bottom:0">'+filterChips+'</div>'+
  '<select style="font-size:12px;padding:4px 8px;border:1px solid var(--border);border-radius:var(--radius-xs);font-family:var(--font-body)" onchange="setQFilter(\'subjectId\',this.value)" aria-label="Mat√©ria"><option value=""'+(qFilter.subjectId?'':' selected')+'>Todas</option>'+subjectOptions(qFilter.subjectId)+'</select>'+
  '<select style="font-size:12px;padding:4px 8px;border:1px solid var(--border);border-radius:var(--radius-xs);font-family:var(--font-body)" onchange="setQFilter(\'difficulty\',this.value)" aria-label="Dificuldade"><option value=""'+(qFilter.difficulty?'':' selected')+'>Todas</option><option'+(qFilter.difficulty==='F√°cil'?' selected':'')+'>F√°cil</option><option'+(qFilter.difficulty==='M√©dia'?' selected':'')+'>M√©dia</option><option'+(qFilter.difficulty==='Dif√≠cil'?' selected':'')+'>Dif√≠cil</option></select></div></div>'+
  '<div class="card fade-in" style="padding:0">'+listHtml+'</div>';
}

function autoCalcWrong(){var t=parseInt(document.getElementById('qTotal')?.value)||0,c=parseInt(document.getElementById('qCorrect')?.value)||0,w=document.getElementById('qWrong');if(w)w.value=Math.max(0,t-c);}

function saveQuestion(){
  var date=document.getElementById('qDate').value,sid=document.getElementById('qSubject').value,total=parseInt(document.getElementById('qTotal').value)||0,correct=parseInt(document.getElementById('qCorrect').value)||0,wrong=parseInt(document.getElementById('qWrong').value)||0,diff=document.getElementById('qDiff').value,tagsRaw=document.getElementById('qTags').value,notes=document.getElementById('qNotes').value;
  if(!sid){toast('Selecione uma mat√©ria');return;}
  if(total<0||correct<0||wrong<0){toast('Valores n√£o podem ser negativos');return;}
  if(correct+wrong!==total){toast('Acertos ('+correct+') + Erros ('+wrong+') ‚â† Total ('+total+')');return;}
  var tags=tagsRaw.split(',').map(t=>t.trim()).filter(Boolean),now=new Date().toISOString();
  if(editingQuestionId){var e=state.questionEntries.find(x=>x.id===editingQuestionId);if(e)Object.assign(e,{date,subjectId:sid,total,correct,wrong,difficulty:diff,tags,errorNotes:notes,updatedAt:now});editingQuestionId=null;toast('Atualizado');}
  else{state.questionEntries.push({id:uid(),date,subjectId:sid,total,correct,wrong,difficulty:diff,tags,errorNotes:notes,createdAt:now});toast('Quest√µes registradas');}
  saveState();renderView();
}

function editQuestion(id){var e=state.questionEntries.find(x=>x.id===id);if(!e)return;editingQuestionId=id;renderView();
  setTimeout(function(){document.getElementById('qDate').value=e.date;document.getElementById('qSubject').value=e.subjectId;document.getElementById('qTotal').value=e.total;document.getElementById('qCorrect').value=e.correct;document.getElementById('qWrong').value=e.wrong;document.getElementById('qDiff').value=e.difficulty;document.getElementById('qTags').value=(e.tags||[]).join(', ');document.getElementById('qNotes').value=e.errorNotes||'';document.getElementById('qFormCard').scrollIntoView({behavior:'smooth'});},50);}
function cancelEditQuestion(){editingQuestionId=null;renderView();}
function deleteQuestion(id){state.questionEntries=state.questionEntries.filter(e=>e.id!==id);saveState();hideConfirm();renderView();toast('Exclu√≠do');}
function setQFilter(k,v){qFilter[k]=v;renderView();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TEMPO MODULE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTempo(){
  var agg=aggregateStudy(state.studyEntries,tFilter);
  var sorted=[...agg.filtered].sort((a,b)=>b.date.localeCompare(a.date)||b.createdAt.localeCompare(a.createdAt));
  var todayA=aggregateStudy(state.studyEntries,{range:'today'}),w7=aggregateStudy(state.studyEntries,{range:'7'});
  var maxM=Math.max(...Object.values(w7.bySubjectMinutes),1);
  var barData=state.subjects.filter(s=>w7.bySubjectMinutes[s.id]).sort((a,b)=>(w7.bySubjectMinutes[b.id]||0)-(w7.bySubjectMinutes[a.id]||0));
  var formTitle=editingStudyId?'‚úèÔ∏è Editando Registro':'‚ûï Novo Registro de Tempo';
  var cancelBtn=editingStudyId?'<button class="btn btn-sm btn-secondary" onclick="cancelEditStudy()">Cancelar</button>':'';
  var saveLabel=editingStudyId?'Atualizar':'Salvar';

  var barsHtml=barData.length>0?'<div class="section-title fade-in"><span class="dot" style="background:var(--status-progress)"></span> Tempo por Mat√©ria (7 dias)</div><div class="card fade-in" style="margin-bottom:24px">'+
    barData.map(s=>{var m=w7.bySubjectMinutes[s.id]||0;return'<div class="hbar-row"><span class="hbar-label"><span class="subject-group-tag '+groupColor(s.group)+'" style="font-size:10px;padding:1px 6px">'+s.group+'</span> '+getSubjectShort(s.id)+'</span><div class="hbar-track"><div class="hbar-fill" style="width:'+pct(m,maxM)+'%;background:var(--'+groupColor(s.group)+')"></div></div><span class="hbar-value">'+formatMinutes(m)+'</span></div>';}).join('')+'</div>':'';

  var filterChips=['all','today','7','30'].map(r=>'<span class="chip '+(tFilter.range===r?'active-all':'')+'" onclick="setTFilter(\'range\',\''+r+'\')">'+(r==='all'?'Todos':r==='today'?'Hoje':r+' dias')+'</span>').join('');

  var listHtml=sorted.length===0?'<div class="empty-state"><p>Nenhum registro encontrado</p></div>':sorted.map(e=>{
    var dateDisplay=tFilter.range==='all'?e.date:e.date.slice(5).replace('-','/');
    return'<div class="entry-item"><span class="entry-date">'+dateDisplay+'</span><span class="entry-subject">'+getSubjectShort(e.subjectId)+'</span><div class="entry-details"><span class="entry-stat"><strong>'+formatMinutes(e.minutes)+'</strong></span>'+(e.notes?'<span class="entry-stat" style="font-size:12px;color:var(--text-muted)">'+escHtml(e.notes)+'</span>':'')+'</div><div class="entry-actions"><button onclick="editStudyTime(\''+e.id+'\')" aria-label="Editar" title="Editar">‚úèÔ∏è</button><button class="del" onclick="showConfirm(\'Excluir este registro?\',function(){deleteStudyTime(\''+e.id+'\')})" aria-label="Excluir" title="Excluir">üóëÔ∏è</button></div></div>';}).join('');

  return'<h1 class="page-title fade-in">Tempo de Estudo</h1><p class="page-subtitle fade-in">Registre e acompanhe suas horas por mat√©ria</p>'+
  '<div class="card fade-in" style="margin-bottom:24px" id="tFormCard"><div class="card-header"><span class="card-title">'+formTitle+'</span>'+cancelBtn+'</div>'+
  '<div class="form-grid"><div class="form-group"><label for="tDate">Data</label><input type="date" id="tDate" value="'+todayKey()+'"></div>'+
  '<div class="form-group"><label for="tSubject">Mat√©ria *</label><select id="tSubject"><option value="">Selecione...</option>'+subjectOptions()+'</select></div>'+
  '<div class="form-group"><label for="tMinutes">Minutos *</label><input type="number" id="tMinutes" min="1" placeholder="ex: 45"></div>'+
  '<div class="form-group"><label for="tNotes">Notas</label><input type="text" id="tNotes" placeholder="Opcional"></div></div>'+
  '<div class="form-actions"><button class="btn btn-primary" onclick="saveStudyTime()">üíæ '+saveLabel+'</button></div></div>'+
  '<div class="summary-row fade-in"><div class="summary-mini" style="border-left:3px solid var(--status-progress)"><div class="sm-label">‚è±Ô∏è Hoje</div><div class="sm-value">'+formatHHMM(todayA.totalMinutes)+'</div><div class="sm-sub">'+formatMinutes(todayA.totalMinutes)+'</div></div>'+
  '<div class="summary-mini" style="border-left:3px solid var(--accent)"><div class="sm-label">‚è±Ô∏è 7 Dias</div><div class="sm-value">'+formatHHMM(w7.totalMinutes)+'</div><div class="sm-sub">'+formatMinutes(w7.totalMinutes)+'</div></div>'+
  '<div class="summary-mini" style="border-left:3px solid var(--group-c)"><div class="sm-label">üìä M√©dia/Dia</div><div class="sm-value">'+formatMinutes(Math.round(w7.totalMinutes/7))+'</div></div></div>'+
  barsHtml+
  '<div class="section-title fade-in"><span class="dot" style="background:var(--group-b)"></span> Lan√ßamentos</div>'+
  '<div class="card fade-in" style="padding:12px 16px;margin-bottom:12px"><div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center"><div class="filter-chips" style="margin-bottom:0">'+filterChips+'</div>'+
  '<select style="font-size:12px;padding:4px 8px;border:1px solid var(--border);border-radius:var(--radius-xs);font-family:var(--font-body)" onchange="setTFilter(\'subjectId\',this.value)" aria-label="Mat√©ria"><option value=""'+(tFilter.subjectId?'':' selected')+'>Todas</option>'+subjectOptions(tFilter.subjectId)+'</select></div></div>'+
  '<div class="card fade-in" style="padding:0">'+listHtml+'</div>';
}

function saveStudyTime(){
  var date=document.getElementById('tDate').value,sid=document.getElementById('tSubject').value,mins=parseInt(document.getElementById('tMinutes').value)||0,notes=document.getElementById('tNotes').value;
  if(!sid){toast('Selecione uma mat√©ria');return;}
  if(mins<=0){toast('Minutos deve ser > 0');return;}
  var now=new Date().toISOString();
  if(editingStudyId){var e=state.studyEntries.find(x=>x.id===editingStudyId);if(e)Object.assign(e,{date,subjectId:sid,minutes:mins,notes,updatedAt:now});editingStudyId=null;toast('Atualizado');}
  else{state.studyEntries.push({id:uid(),date,subjectId:sid,minutes:mins,notes,createdAt:now});toast('Tempo registrado');}
  saveState();renderView();
}

function editStudyTime(id){var e=state.studyEntries.find(x=>x.id===id);if(!e)return;editingStudyId=id;renderView();
  setTimeout(function(){document.getElementById('tDate').value=e.date;document.getElementById('tSubject').value=e.subjectId;document.getElementById('tMinutes').value=e.minutes;document.getElementById('tNotes').value=e.notes||'';document.getElementById('tFormCard').scrollIntoView({behavior:'smooth'});},50);}
function cancelEditStudy(){editingStudyId=null;renderView();}
function deleteStudyTime(id){state.studyEntries=state.studyEntries.filter(e=>e.id!==id);saveState();hideConfirm();renderView();toast('Exclu√≠do');}
function setTFilter(k,v){tFilter[k]=v;renderView();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// METAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMetas(){
  var gs=[{key:'A',label:'Grupo A ‚Äî Alt√≠ssima Prioridade',emoji:'üî¥'},{key:'B',label:'Grupo B ‚Äî Base Jur√≠dica',emoji:'üü°'},{key:'C',label:'Grupo C ‚Äî Complementares',emoji:'üü¢'}];
  var tg=metasState.totalWeekly;
  return'<h1 class="page-title fade-in">Metas Semanais</h1><p class="page-subtitle fade-in">Distribua seus t√≥picos semanais por grupo</p>'+
  '<div class="card fade-in" style="margin-bottom:24px"><div class="card-header"><span class="card-title">Meta Total Semanal</span></div><div style="display:flex;align-items:center;gap:16px"><input class="meta-input" type="number" min="1" max="100" value="'+tg+'" onchange="updateTotalMeta(this.value)" style="font-size:18px;width:80px;font-weight:700" aria-label="Meta total"><span style="font-size:14px;color:var(--text-secondary)">t√≥picos/semana</span></div><div style="margin-top:12px;font-size:12px;color:var(--text-muted)">Distribui√ß√£o: A=50%, B=30%, C=20%. Edit√°vel abaixo.</div></div>'+
  gs.map(g=>{var ag=Math.round(tg*metasState.groups[g.key]/100),wd=getWeekDone(g.key),wp=pct(wd,ag);
    return'<div class="card fade-in" style="margin-bottom:16px;border-left:3px solid var(--'+groupColor(g.key)+')"><div class="meta-row" style="border:none;padding:4px 0"><span style="font-size:20px">'+g.emoji+'</span><span class="meta-label" style="flex:1;min-width:auto">'+g.label+'</span><div style="display:flex;align-items:center;gap:8px"><input class="meta-input" type="number" min="0" max="100" value="'+metasState.groups[g.key]+'" onchange="updateGroupPct(\''+g.key+'\',this.value)" aria-label="%"><span style="font-size:12px;color:var(--text-muted)">%</span></div></div>'+
    '<div style="display:flex;align-items:center;gap:12px;margin-top:8px"><span style="font-size:13px;font-weight:600">'+wd+'/'+ag+'</span><div class="meta-bar" style="flex:1"><div class="meta-bar-fill" style="width:'+Math.min(wp,100)+'%;background:var(--'+groupColor(g.key)+')"></div></div><span style="font-size:13px;font-weight:600;color:'+(wp>=100?'var(--status-done)':'var(--text-secondary)')+'">'+wp+'%</span></div>'+
    '<div style="margin-top:12px">'+getGroupSubjects(g.key).map(s=>'<div style="display:flex;align-items:center;gap:10px;padding:6px 0;font-size:13px"><span style="flex:1;color:var(--text-secondary)">'+s.name+'</span><span style="font-weight:600">'+getSubjectWeekDone(s.id)+' esta semana</span></div>').join('')+'</div></div>';}).join('');
}
function updateTotalMeta(v){metasState.totalWeekly=parseInt(v)||20;saveMetas();renderView();}
function updateGroupPct(g,v){metasState.groups[g]=parseInt(v)||0;saveMetas();renderView();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REDA√á√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderRedacao(){
  var mn=new Date().toLocaleString('pt-BR',{month:'long'});
  return'<h1 class="page-title fade-in">Reda√ß√£o</h1><p class="page-subtitle fade-in">Acompanhe temas e crit√©rios de qualidade</p>'+
  '<div class="month-counter fade-in">‚úçÔ∏è <strong>'+redacaoState.monthCount+'</strong> reda√ß√£o(√µes) em '+mn+' <button class="btn btn-sm btn-primary" onclick="incrementRedacao()" style="margin-left:8px">+ Feita</button></div>'+
  redacaoState.themes.map((th,i)=>'<div class="redacao-card fade-in"><div class="redacao-title">'+(i+1)+'. '+th.text+'</div>'+
    '<div class="check-row"><input type="checkbox" id="rc_'+th.id+'_e" '+(th.estrutura?'checked':'')+' onchange="toggleRedacaoCheck(\''+th.id+'\',\'estrutura\',this.checked)"><label for="rc_'+th.id+'_e">Estrutura dissertativa ok?</label></div>'+
    '<div class="check-row"><input type="checkbox" id="rc_'+th.id+'_t" '+(th.tese?'checked':'')+' onchange="toggleRedacaoCheck(\''+th.id+'\',\'tese\',this.checked)"><label for="rc_'+th.id+'_t">Tese clara?</label></div>'+
    '<div class="check-row"><input type="checkbox" id="rc_'+th.id+'_a" '+(th.argumentos?'checked':'')+' onchange="toggleRedacaoCheck(\''+th.id+'\',\'argumentos\',this.checked)"><label for="rc_'+th.id+'_a">2 argumentos?</label></div>'+
    '<div class="check-row"><input type="checkbox" id="rc_'+th.id+'_c" '+(th.conectivos?'checked':'')+' onchange="toggleRedacaoCheck(\''+th.id+'\',\'conectivos\',this.checked)"><label for="rc_'+th.id+'_c">Conectivos variados?</label></div>'+
    '<textarea class="redacao-notes" placeholder="Notas..." oninput="updateRedacaoNotes(\''+th.id+'\',this.value)" aria-label="Notas">'+((th.notes||''))+'</textarea></div>').join('');
}
function toggleRedacaoCheck(id,f,v){var t=redacaoState.themes.find(x=>x.id===id);if(t){t[f]=v;saveRedacao();}}
function updateRedacaoNotes(id,v){var t=redacaoState.themes.find(x=>x.id===id);if(t){t.notes=v;saveRedacao();}}
function incrementRedacao(){redacaoState.monthCount++;saveRedacao();renderView();toast('Reda√ß√£o registrada!');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LEI SECA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderLeiSeca(){
  var ls=state.subjects.find(s=>s.id==='leg');if(!ls)return'<p>N√£o encontrada.</p>';
  var tL=ls.topics.length,dL=countByStatus(ls.topics,'Conclu√≠do'),pL=countByStatus(ls.topics,'Em andamento');
  return'<div class="lei-seca-mode"><div class="lei-seca-header"><button class="lei-seca-back" onclick="navigateTo(\'dashboard\')">‚Üê Voltar</button><h2>üìú Modo Lei Seca</h2></div>'+
  '<div class="lei-seca-stat">Cobertura: <strong>'+pct(dL,tL)+'%</strong> ¬∑ '+dL+'/'+tL+' conclu√≠dos ¬∑ '+pL+' em andamento</div>'+
  '<div class="topic-list">'+ls.topics.map(t=>'<div class="topic-item" data-topic-id="'+t.id+'" style="padding:8px 12px"><span class="topic-number">'+t.number+'</span><span class="topic-text '+(t.status==='Conclu√≠do'?'done':'')+'" style="font-size:14px">'+t.text+'</span><select class="status-select '+statusClass(t.status)+'" onchange="changeStatus(\'leg\',\''+t.id+'\',this.value)" aria-label="Status"><option'+(t.status==='N√£o iniciado'?' selected':'')+'>N√£o iniciado</option><option'+(t.status==='Em andamento'?' selected':'')+'>Em andamento</option><option'+(t.status==='Revisar'?' selected':'')+'>Revisar</option><option'+(t.status==='Conclu√≠do'?' selected':'')+'>Conclu√≠do</option></select></div>').join('')+'</div></div>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REVIS√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderRevisao(){
  var q=getReviewQueue();
  return'<h1 class="page-title fade-in">Fila de Revis√£o</h1><p class="page-subtitle fade-in">T√≥picos com prazo ‚â§ 7 dias</p>'+
  (q.length===0?'<div class="empty-state card fade-in" style="padding:60px"><p>Nenhuma revis√£o pendente üéâ</p></div>':
  '<div style="margin-bottom:12px;font-size:13px;color:var(--text-secondary)">'+q.length+' t√≥pico(s)</div>'+
  q.map(t=>'<div class="review-item fade-in" style="margin-bottom:8px"><span class="subject-group-tag '+groupColor(t.group)+'">'+t.group+'</span><div style="flex:1"><div class="review-subject">'+t.subjectName+'</div><div class="review-topic">'+t.text+'</div></div>'+(t.reviewDueAt?'<span style="font-size:11px;color:var(--text-muted)">'+new Date(t.reviewDueAt).toLocaleDateString('pt-BR')+'</span>':'')+
  '<select class="status-select '+statusClass(t.status)+'" onchange="changeStatus(\''+t.subjectId+'\',\''+t.id+'\',this.value)" aria-label="Status"><option>N√£o iniciado</option><option>Em andamento</option><option selected>Revisar</option><option>Conclu√≠do</option></select></div>').join(''));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEARCH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleSearch(val){
  searchQuery=val.toLowerCase().trim();
  if(currentView==='dashboard'&&searchQuery){currentView='materias';document.querySelectorAll('.nav-item').forEach(n=>{n.classList.remove('active');n.removeAttribute('aria-current');});var el=document.querySelector('.nav-item[data-view="materias"]');if(el){el.classList.add('active');el.setAttribute('aria-current','page');}}
  renderView();
  if(searchQuery){state.subjects.forEach(s=>{if(s.topics.some(t=>t.text.toLowerCase().includes(searchQuery))){var b=document.getElementById('body-'+s.id),h=b?.previousElementSibling;if(b&&!b.classList.contains('open')){b.classList.add('open');if(h)h.classList.add('open');}}});}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTES MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openNotesModal(sId,tId){currentNotesTopicId={subjectId:sId,topicId:tId};var sub=state.subjects.find(s=>s.id===sId),topic=sub?.topics.find(t=>t.id===tId);if(!topic)return;document.getElementById('notesModalTitle').textContent='Anota√ß√µes ‚Äî '+topic.text;document.getElementById('notesModalText').value=topic.notes||'';document.getElementById('notesModal').classList.add('show');setTimeout(()=>document.getElementById('notesModalText').focus(),100);}
function closeNotesModal(){document.getElementById('notesModal').classList.remove('show');currentNotesTopicId=null;}
function saveNotes(){if(!currentNotesTopicId)return;var{subjectId,topicId}=currentNotesTopicId;var sub=state.subjects.find(s=>s.id===subjectId),topic=sub?.topics.find(t=>t.id===topicId);if(topic){topic.notes=document.getElementById('notesModalText').value;saveState();toast('Anota√ß√£o salva');}closeNotesModal();renderView();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIRM MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var confirmCallback=null;
function showConfirm(msg,cb){document.getElementById('confirmMsg').textContent=msg;confirmCallback=cb;document.getElementById('confirmOverlay').classList.add('show');document.getElementById('confirmYes').onclick=function(){if(confirmCallback)confirmCallback();};document.getElementById('confirmYes').focus();}
function hideConfirm(){document.getElementById('confirmOverlay').classList.remove('show');confirmCallback=null;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GLOBAL ACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function markVisibleDone(){var items=document.querySelectorAll('.topic-item[data-topic-id]'),count=0;items.forEach(el=>{var tid=el.dataset.topicId;for(var s of state.subjects){var t=s.topics.find(x=>x.id===tid);if(t&&t.status!=='Conclu√≠do'){t.status='Conclu√≠do';t.updatedAt=new Date().toISOString();t.reviewDueAt=null;count++;break;}}});if(count>0){saveState();renderView();toast(count+' conclu√≠do(s)');}else toast('Nenhum vis√≠vel');}

function exportData(){var data={version:2,exportedAt:new Date().toISOString(),state:state,redacaoState:redacaoState,metasState:metasState};var blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});var url=URL.createObjectURL(blob);var a=document.createElement('a');a.href=url;a.download='tjsc-estudos-'+new Date().toISOString().slice(0,10)+'.json';a.click();URL.revokeObjectURL(url);toast('Exportado');}

function importData(event){var file=event.target.files[0];if(!file)return;var reader=new FileReader();reader.onload=function(e){try{var data=JSON.parse(e.target.result);if(data.state){migrateState(data.state);localStorage.setItem(STORAGE_KEY,JSON.stringify(data.state));}if(data.redacaoState)localStorage.setItem(REDACAO_KEY,JSON.stringify(data.redacaoState));if(data.metasState)localStorage.setItem(METAS_KEY,JSON.stringify(data.metasState));loadState();loadRedacao();loadMetas();renderView();toast('Importado');}catch(err){toast('Erro ao importar');}};reader.readAsText(file);event.target.value='';}

function confirmReset(){localStorage.removeItem(STORAGE_KEY);localStorage.removeItem(REDACAO_KEY);localStorage.removeItem(METAS_KEY);state={schemaVersion:2,subjects:[],questionEntries:[],studyEntries:[],settings:{studyWeekMode:"rolling7"}};loadState();loadRedacao();loadMetas();hideConfirm();renderView();toast('Resetado');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg){var c=document.getElementById('toastContainer'),el=document.createElement('div');el.className='toast';el.textContent=msg;c.appendChild(el);setTimeout(function(){el.classList.add('out');setTimeout(()=>el.remove(),300);},2500);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function init(){loadState();loadRedacao();loadMetas();setupNav();setupKeyboard();renderView();}
init();
</script>
</body>
</html>

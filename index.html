<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TJ-SC T√©cnico Judici√°rio ‚Äî Painel de Estudos</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;0,9..144,700;1,9..144,400&display=swap');

:root {
  --bg: #F7F6F3;
  --bg-card: #FFFFFF;
  --bg-hover: #F0EFEC;
  --text-primary: #1A1A1A;
  --text-secondary: #6B6B6B;
  --text-muted: #9B9B9B;
  --border: #E8E6E1;
  --border-light: #F0EFEC;

  --group-a: #DC2626;
  --group-a-bg: #FEF2F2;
  --group-a-border: #FECACA;
  --group-a-light: #FCA5A5;

  --group-b: #D97706;
  --group-b-bg: #FFFBEB;
  --group-b-border: #FDE68A;
  --group-b-light: #FCD34D;

  --group-c: #059669;
  --group-c-bg: #ECFDF5;
  --group-c-border: #A7F3D0;
  --group-c-light: #6EE7B7;

  --status-done: #059669;
  --status-progress: #2563EB;
  --status-review: #D97706;
  --status-pending: #9CA3AF;

  --accent: #4F46E5;
  --accent-light: #EEF2FF;

  --radius: 12px;
  --radius-sm: 8px;
  --radius-xs: 6px;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
  --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.05), 0 2px 4px rgba(0,0,0,0.04);
  --shadow-lg: 0 10px 25px rgba(0,0,0,0.08);

  --font-body: 'DM Sans', -apple-system, sans-serif;
  --font-display: 'Fraunces', Georgia, serif;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html { scroll-behavior: smooth; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

/* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

/* ‚îÄ‚îÄ Layout Shell ‚îÄ‚îÄ */
.app-shell { display: flex; min-height: 100vh; }

.sidebar {
  width: 260px;
  background: var(--bg-card);
  border-right: 1px solid var(--border);
  padding: 24px 0;
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  z-index: 100;
  transition: transform 0.3s ease;
}

.sidebar-header {
  padding: 0 20px 20px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 8px;
}

.sidebar-logo {
  font-family: var(--font-display);
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: -0.02em;
}

.sidebar-logo span { color: var(--accent); }

.sidebar-sub {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 2px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-weight: 500;
}

.sidebar-nav { flex: 1; padding: 8px 12px; overflow-y: auto; }

.nav-section-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--text-muted);
  padding: 16px 8px 6px;
  font-weight: 600;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 13.5px;
  font-weight: 500;
  color: var(--text-secondary);
  transition: all 0.15s;
  user-select: none;
  border: 1px solid transparent;
}

.nav-item:hover { background: var(--bg-hover); color: var(--text-primary); }
.nav-item.active {
  background: var(--accent-light);
  color: var(--accent);
  border-color: rgba(79,70,229,0.1);
  font-weight: 600;
}

.nav-item svg { width: 18px; height: 18px; flex-shrink: 0; opacity: 0.7; }
.nav-item.active svg { opacity: 1; }

.nav-item .nav-badge {
  margin-left: auto;
  font-size: 11px;
  font-weight: 600;
  padding: 1px 7px;
  border-radius: 10px;
  background: var(--group-a-bg);
  color: var(--group-a);
}

.sidebar-footer {
  padding: 12px 20px;
  border-top: 1px solid var(--border);
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.sidebar-footer button {
  flex: 1;
  min-width: 60px;
  padding: 7px 10px;
  font-size: 11px;
  font-weight: 600;
  border: 1px solid var(--border);
  border-radius: var(--radius-xs);
  background: var(--bg-card);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.15s;
  font-family: var(--font-body);
}

.sidebar-footer button:hover { background: var(--bg-hover); color: var(--text-primary); }

.main-content {
  flex: 1;
  margin-left: 260px;
  min-height: 100vh;
}

/* ‚îÄ‚îÄ Top Bar ‚îÄ‚îÄ */
.top-bar {
  position: sticky;
  top: 0;
  z-index: 50;
  background: rgba(247,246,243,0.85);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 12px 32px;
  display: flex;
  align-items: center;
  gap: 16px;
}

.menu-toggle {
  display: none;
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px;
  color: var(--text-secondary);
}

.menu-toggle svg { width: 22px; height: 22px; }

.search-box {
  flex: 1;
  max-width: 420px;
  position: relative;
}

.search-box svg {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  color: var(--text-muted);
}

.search-box input {
  width: 100%;
  padding: 9px 12px 9px 38px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 13.5px;
  font-family: var(--font-body);
  background: var(--bg-card);
  color: var(--text-primary);
  transition: all 0.15s;
}

.search-box input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(79,70,229,0.1); }
.search-box input::placeholder { color: var(--text-muted); }

.top-bar-right {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-left: auto;
}

.page-content { padding: 28px 32px 60px; max-width: 1200px; }

.page-title {
  font-family: var(--font-display);
  font-size: 26px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 4px;
  letter-spacing: -0.02em;
}

.page-subtitle {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 28px;
}

/* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
.card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: var(--shadow-sm);
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

.card-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}

.card-value {
  font-family: var(--font-display);
  font-size: 32px;
  font-weight: 700;
  line-height: 1.1;
}

/* ‚îÄ‚îÄ Dashboard Grid ‚îÄ‚îÄ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card { position: relative; overflow: hidden; }

.stat-card .stat-accent {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
}

.stat-card.group-a .stat-accent { background: var(--group-a); }
.stat-card.group-b .stat-accent { background: var(--group-b); }
.stat-card.group-c .stat-accent { background: var(--group-c); }
.stat-card.general .stat-accent { background: var(--accent); }

.stat-label {
  font-size: 12px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  font-weight: 600;
  margin-bottom: 8px;
}

.stat-number {
  font-family: var(--font-display);
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
}

.stat-sub {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 4px;
}

/* ‚îÄ‚îÄ Progress Bar ‚îÄ‚îÄ */
.progress-bar {
  height: 8px;
  background: var(--border-light);
  border-radius: 4px;
  overflow: hidden;
  margin-top: 10px;
}

.progress-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.4s ease;
}

.progress-fill.group-a { background: var(--group-a); }
.progress-fill.group-b { background: var(--group-b); }
.progress-fill.group-c { background: var(--group-c); }
.progress-fill.general { background: var(--accent); }

/* ‚îÄ‚îÄ Sections ‚îÄ‚îÄ */
.section-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 24px;
}

.section-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-title .dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  display: inline-block;
}

/* ‚îÄ‚îÄ Topic List ‚îÄ‚îÄ */
.topic-list { display: flex; flex-direction: column; gap: 2px; }

.topic-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  border-radius: var(--radius-sm);
  transition: all 0.12s;
  cursor: default;
  border: 1px solid transparent;
}

.topic-item:hover { background: var(--bg-hover); }

.topic-number {
  font-size: 11px;
  font-weight: 700;
  color: var(--text-muted);
  min-width: 28px;
  text-align: center;
  background: var(--bg);
  padding: 2px 6px;
  border-radius: var(--radius-xs);
}

.topic-text {
  flex: 1;
  font-size: 13.5px;
  color: var(--text-primary);
}

.topic-text.done { text-decoration: line-through; color: var(--text-muted); }

.topic-actions { display: flex; gap: 4px; align-items: center; }

.status-select {
  font-size: 12px;
  font-family: var(--font-body);
  padding: 4px 8px;
  border: 1px solid var(--border);
  border-radius: var(--radius-xs);
  background: var(--bg-card);
  color: var(--text-secondary);
  cursor: pointer;
  font-weight: 500;
  transition: all 0.15s;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%239B9B9B' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 8px center;
  padding-right: 24px;
}

.status-select:focus { outline: none; border-color: var(--accent); }

.status-select.s-done { border-color: var(--group-c-border); color: var(--status-done); background-color: var(--group-c-bg); }
.status-select.s-progress { border-color: #BFDBFE; color: var(--status-progress); background-color: #EFF6FF; }
.status-select.s-review { border-color: var(--group-b-border); color: var(--status-review); background-color: var(--group-b-bg); }

.notes-btn {
  width: 28px;
  height: 28px;
  border: 1px solid var(--border);
  border-radius: var(--radius-xs);
  background: var(--bg-card);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-muted);
  transition: all 0.15s;
}

.notes-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
.notes-btn.has-notes { color: var(--accent); border-color: rgba(79,70,229,0.3); }
.notes-btn svg { width: 14px; height: 14px; }

/* ‚îÄ‚îÄ Subject Card ‚îÄ‚îÄ */
.subject-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 16px;
  box-shadow: var(--shadow-sm);
}

.subject-header {
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
  transition: background 0.12s;
  user-select: none;
}

.subject-header:hover { background: var(--bg-hover); }

.subject-group-tag {
  font-size: 11px;
  font-weight: 700;
  padding: 3px 10px;
  border-radius: 20px;
  letter-spacing: 0.05em;
}

.subject-group-tag.group-a { background: var(--group-a-bg); color: var(--group-a); border: 1px solid var(--group-a-border); }
.subject-group-tag.group-b { background: var(--group-b-bg); color: var(--group-b); border: 1px solid var(--group-b-border); }
.subject-group-tag.group-c { background: var(--group-c-bg); color: var(--group-c); border: 1px solid var(--group-c-border); }

.subject-name {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary);
  flex: 1;
}

.subject-progress-mini {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-secondary);
}

.subject-chevron {
  width: 20px; height: 20px;
  color: var(--text-muted);
  transition: transform 0.2s;
}

.subject-header.open .subject-chevron { transform: rotate(180deg); }

.subject-body { display: none; border-top: 1px solid var(--border); padding: 8px 12px 12px; }
.subject-body.open { display: block; }

/* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
.tabs {
  display: flex;
  gap: 2px;
  background: var(--bg);
  padding: 3px;
  border-radius: var(--radius-sm);
  margin-bottom: 20px;
  width: fit-content;
}

.tab-btn {
  padding: 7px 16px;
  border: none;
  border-radius: var(--radius-xs);
  font-size: 13px;
  font-weight: 500;
  font-family: var(--font-body);
  color: var(--text-secondary);
  background: transparent;
  cursor: pointer;
  transition: all 0.15s;
}

.tab-btn:hover { color: var(--text-primary); }
.tab-btn.active { background: var(--bg-card); color: var(--text-primary); box-shadow: var(--shadow-sm); font-weight: 600; }

/* ‚îÄ‚îÄ Metas ‚îÄ‚îÄ */
.meta-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 0;
  border-bottom: 1px solid var(--border-light);
}

.meta-row:last-child { border-bottom: none; }

.meta-label {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
  min-width: 80px;
}

.meta-input {
  width: 70px;
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: var(--radius-xs);
  font-size: 13px;
  font-family: var(--font-body);
  text-align: center;
  color: var(--text-primary);
}

.meta-input:focus { outline: none; border-color: var(--accent); }

.meta-bar {
  flex: 1;
  height: 6px;
  background: var(--border-light);
  border-radius: 3px;
  overflow: hidden;
}

.meta-bar-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.3s;
}

.meta-info {
  font-size: 12px;
  color: var(--text-muted);
  min-width: 60px;
  text-align: right;
}

/* ‚îÄ‚îÄ Reda√ß√£o ‚îÄ‚îÄ */
.redacao-card {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 12px;
  background: var(--bg-card);
}

.redacao-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 10px;
}

.check-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 0;
  font-size: 13px;
  color: var(--text-secondary);
}

.check-row input[type="checkbox"] {
  accent-color: var(--accent);
  width: 16px;
  height: 16px;
}

.redacao-notes {
  width: 100%;
  margin-top: 10px;
  padding: 8px 12px;
  border: 1px solid var(--border);
  border-radius: var(--radius-xs);
  font-size: 13px;
  font-family: var(--font-body);
  resize: vertical;
  min-height: 50px;
  color: var(--text-primary);
}

.redacao-notes:focus { outline: none; border-color: var(--accent); }

/* ‚îÄ‚îÄ Lei Seca ‚îÄ‚îÄ */
.lei-seca-mode {
  background: #1A1A2E;
  color: #E8E6E1;
  min-height: 100vh;
  padding: 24px;
}

.lei-seca-mode .topic-item { border-color: rgba(255,255,255,0.06); }
.lei-seca-mode .topic-item:hover { background: rgba(255,255,255,0.04); }
.lei-seca-mode .topic-text { color: #E8E6E1; }
.lei-seca-mode .topic-number { background: rgba(255,255,255,0.08); color: #9B9B9B; }
.lei-seca-mode .status-select { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.1); color: #ccc; }

.lei-seca-header {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
}

.lei-seca-header h2 {
  font-family: var(--font-display);
  font-size: 22px;
  color: #F7F6F3;
}

.lei-seca-back {
  padding: 8px 16px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: var(--radius-xs);
  background: transparent;
  color: #ccc;
  font-size: 13px;
  cursor: pointer;
  font-family: var(--font-body);
  font-weight: 500;
}

.lei-seca-back:hover { background: rgba(255,255,255,0.06); }

.lei-seca-stat {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 14px;
  background: rgba(255,255,255,0.06);
  border-radius: 20px;
  font-size: 13px;
  color: #ccc;
  margin-bottom: 20px;
}

.lei-seca-statute {
  margin-bottom: 24px;
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius);
  padding: 16px;
}

.lei-seca-statute-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--group-a-light);
  margin-bottom: 12px;
}

/* ‚îÄ‚îÄ Review Queue ‚îÄ‚îÄ */
.review-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--group-b-border);
  background: var(--group-b-bg);
  margin-bottom: 6px;
}

.review-item .review-subject {
  font-size: 11px;
  font-weight: 600;
  color: var(--group-b);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.review-item .review-topic {
  font-size: 13px;
  color: var(--text-primary);
  flex: 1;
}

.review-item .review-due {
  font-size: 11px;
  color: var(--group-a);
  font-weight: 600;
}

/* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(4px);
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}

.modal-overlay.show { opacity: 1; pointer-events: all; }

.modal {
  background: var(--bg-card);
  border-radius: var(--radius);
  max-width: 500px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: var(--shadow-lg);
  transform: translateY(10px);
  transition: transform 0.2s;
}

.modal-overlay.show .modal { transform: translateY(0); }

.modal-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.modal-title { font-size: 16px; font-weight: 600; }

.modal-close {
  width: 32px; height: 32px;
  border: none;
  background: var(--bg);
  border-radius: var(--radius-xs);
  cursor: pointer;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}

.modal-close:hover { background: var(--bg-hover); }

.modal-body { padding: 20px 24px; }

.modal-body textarea {
  width: 100%;
  min-height: 120px;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font-family: var(--font-body);
  font-size: 13.5px;
  resize: vertical;
  color: var(--text-primary);
}

.modal-body textarea:focus { outline: none; border-color: var(--accent); }

.modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

/* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
.btn {
  padding: 8px 16px;
  border-radius: var(--radius-xs);
  font-size: 13px;
  font-weight: 600;
  font-family: var(--font-body);
  cursor: pointer;
  transition: all 0.15s;
  border: 1px solid transparent;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.btn-primary { background: var(--accent); color: white; }
.btn-primary:hover { background: #4338CA; }

.btn-secondary { background: var(--bg); border-color: var(--border); color: var(--text-secondary); }
.btn-secondary:hover { background: var(--bg-hover); color: var(--text-primary); }

.btn-danger { background: #FEF2F2; border-color: var(--group-a-border); color: var(--group-a); }
.btn-danger:hover { background: #FEE2E2; }

.btn-sm { padding: 5px 10px; font-size: 12px; }

/* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
.toast-container {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 300;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.toast {
  padding: 12px 20px;
  background: var(--text-primary);
  color: white;
  border-radius: var(--radius-sm);
  font-size: 13px;
  font-weight: 500;
  box-shadow: var(--shadow-lg);
  animation: toastIn 0.3s ease;
}

.toast.out { animation: toastOut 0.3s ease forwards; }

@keyframes toastIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes toastOut { to { opacity: 0; transform: translateY(10px); } }

/* ‚îÄ‚îÄ Empty State ‚îÄ‚îÄ */
.empty-state {
  text-align: center;
  padding: 40px;
  color: var(--text-muted);
}

.empty-state svg { width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.4; }
.empty-state p { font-size: 14px; }

/* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
@media (max-width: 900px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); box-shadow: var(--shadow-lg); }
  .main-content { margin-left: 0; }
  .menu-toggle { display: flex; }
  .section-grid { grid-template-columns: 1fr; }
  .page-content { padding: 20px 16px 60px; }
  .top-bar { padding: 12px 16px; }
}

@media (max-width: 600px) {
  .stats-grid { grid-template-columns: 1fr 1fr; }
}

/* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
.fade-in { animation: fadeIn 0.3s ease both; }

.hidden { display: none !important; }

/* ‚îÄ‚îÄ Quick filter chips ‚îÄ‚îÄ */
.filter-chips {
  display: flex;
  gap: 6px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.chip {
  padding: 5px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.15s;
}

.chip:hover { background: var(--bg-hover); }
.chip.active-a { background: var(--group-a-bg); color: var(--group-a); border-color: var(--group-a-border); }
.chip.active-b { background: var(--group-b-bg); color: var(--group-b); border-color: var(--group-b-border); }
.chip.active-c { background: var(--group-c-bg); color: var(--group-c); border-color: var(--group-c-border); }
.chip.active-all { background: var(--accent-light); color: var(--accent); border-color: rgba(79,70,229,0.2); }

/* ‚îÄ‚îÄ Week counter badge ‚îÄ‚îÄ */
.month-counter {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  background: var(--accent-light);
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
  color: var(--accent);
  margin-bottom: 16px;
}

/* import/export hidden input */
#importInput { display: none; }
</style>
</head>
<body>

<div class="app-shell" id="appShell">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">TJ<span>‚Äî</span>SC</div>
      <div class="sidebar-sub">T√©cnico Judici√°rio ¬∑ Estudos</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">Principal</div>
      <div class="nav-item active" data-view="dashboard" tabindex="0">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Dashboard
      </div>
      <div class="nav-item" data-view="materias" tabindex="0">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>
        Mat√©rias
      </div>
      <div class="nav-item" data-view="metas" tabindex="0">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
        Metas Semanais
      </div>
      <div class="nav-item" data-view="redacao" tabindex="0">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
        Reda√ß√£o
      </div>
      <div class="nav-item" data-view="leiseca" tabindex="0">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        Lei Seca
        <span class="nav-badge">A</span>
      </div>
      <div class="nav-section-label">Revis√£o</div>
      <div class="nav-item" data-view="revisao" tabindex="0">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        Fila de Revis√£o
      </div>
    </nav>
    <div class="sidebar-footer">
      <button onclick="exportData()" title="Exportar JSON">üì§ Exportar</button>
      <button onclick="document.getElementById('importInput').click()" title="Importar JSON">üì• Importar</button>
      <button onclick="confirmReset()" title="Resetar tudo">üîÑ Reset</button>
    </div>
    <input type="file" id="importInput" accept=".json" onchange="importData(event)">
  </aside>

  <!-- Main -->
  <div class="main-content">
    <div class="top-bar">
      <button class="menu-toggle" onclick="toggleSidebar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <div class="search-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="globalSearch" placeholder="Buscar t√≥pico, mat√©ria..." oninput="handleSearch(this.value)">
      </div>
      <div class="top-bar-right">
        <button class="btn btn-sm btn-secondary" onclick="markVisibleDone()" title="Marcar vis√≠veis como conclu√≠do">‚úì Concluir vis√≠veis</button>
      </div>
    </div>

    <div class="page-content" id="pageContent">
      <!-- Content injected by JS -->
    </div>
  </div>
</div>

<!-- Notes Modal -->
<div class="modal-overlay" id="notesModal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="notesModalTitle">Anota√ß√µes</span>
      <button class="modal-close" onclick="closeNotesModal()">√ó</button>
    </div>
    <div class="modal-body">
      <textarea id="notesModalText" placeholder="Escreva suas anota√ß√µes aqui..."></textarea>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeNotesModal()">Cancelar</button>
      <button class="btn btn-primary" onclick="saveNotes()">Salvar</button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEED DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SEED_DATA = [
  {
    id: "port", name: "L√≠ngua Portuguesa (FGV)", group: "A", priorityRank: 1,
    weightLabel: "~25% da prova", weeklyGoal: 10, weeklyGoalAuto: 10,
    topics: [
      "Interpreta√ß√£o e compreens√£o de textos","Organiza√ß√£o estrutural dos textos","Marcas de textualidade: coes√£o, coer√™ncia e intertextualidade","Modos de organiza√ß√£o discursiva: descri√ß√£o","Modos de organiza√ß√£o discursiva: narra√ß√£o","Modos de organiza√ß√£o discursiva: exposi√ß√£o","Modos de organiza√ß√£o discursiva: argumenta√ß√£o","Modos de organiza√ß√£o discursiva: injun√ß√£o","Tipos textuais: informativo","Tipos textuais: publicit√°rio","Tipos textuais: propagand√≠stico","Tipos textuais: normativo","Tipos textuais: did√°tico","Tipos textuais: divinat√≥rio","Textos liter√°rios e n√£o liter√°rios","Tipologia da frase portuguesa","Estrutura da frase: deslocamento","Estrutura da frase: substitui√ß√£o","Estrutura da frase: modifica√ß√£o","Estrutura da frase: corre√ß√£o","Problemas estruturais das frases","Norma culta","Pontua√ß√£o e sinais gr√°ficos","Organiza√ß√£o sint√°tica: termos","Organiza√ß√£o sint√°tica: ora√ß√µes","Ordem direta e inversa","Tipos de discurso","Registros de linguagem","Fun√ß√µes da linguagem","Elementos dos atos de comunica√ß√£o","Estrutura e forma√ß√£o de palavras","Formas de abrevia√ß√£o","Classes de palavras ‚Äî vis√£o geral","Aspectos morfol√≥gicos das classes","Aspectos sint√°ticos das classes","Aspectos sem√¢nticos das classes","Modalizadores","Sem√¢ntica: sentido pr√≥prio e figurado","Sin√¥nimos, ant√¥nimos, par√¥nimos, hiper√¥nimos","Polissemia e ambiguidade","Dicion√°rios e organiza√ß√£o de verbetes","Vocabul√°rio: neologismos, arca√≠smos, estrangeirismos, latinismos","Ortografia","Acentua√ß√£o","Crase"
    ]
  },
  {
    id: "leg", name: "Legisla√ß√£o Interna TJ-SC", group: "A", priorityRank: 2,
    weightLabel: "~25% da prova", weeklyGoal: 8, weeklyGoalAuto: 8,
    topics: [
      "Estatuto servidores SC ‚Äî Lei 6.745/85","Regimento Interno TJSC","C√≥digo de √âtica ‚Äî Resolu√ß√£o 22/2021","Regime disciplinar ‚Äî LC 639/2015","C√≥digo de Organiza√ß√£o Judici√°ria ‚Äî Lei 5.624/79","C√≥digo de Normas CGJ"
    ]
  },
  {
    id: "pcivil", name: "Processo Civil", group: "B", priorityRank: 3,
    weightLabel: "Base jur√≠dica", weeklyGoal: 5, weeklyGoalAuto: 5,
    topics: [
      "Princ√≠pios do processo","Devido processo legal","Contradit√≥rio e ampla defesa","Juiz natural","Pressupostos processuais","Jurisdi√ß√£o","Princ√≠pio da in√©rcia","A√ß√£o ‚Äî conceito","Condi√ß√µes da a√ß√£o","Elementos da a√ß√£o","Classifica√ß√£o da a√ß√£o","Coopera√ß√£o internacional ‚Äî disposi√ß√µes gerais","Aux√≠lio direto","Carta rogat√≥ria","Compet√™ncia ‚Äî disposi√ß√µes gerais"
    ]
  },
  {
    id: "ppenal", name: "Processo Penal", group: "B", priorityRank: 4,
    weightLabel: "Base jur√≠dica", weeklyGoal: 5, weeklyGoalAuto: 5,
    topics: [
      "Disposi√ß√µes preliminares CPP","Inqu√©rito policial","A√ß√£o penal","Sujeitos processuais","Auxiliares da justi√ßa","Cita√ß√µes e intima√ß√µes","Senten√ßa","Processo comum","Instru√ß√£o criminal","Tribunal do j√∫ri ‚Äî vis√£o geral","Acusa√ß√£o e instru√ß√£o preliminar","Pron√∫ncia, impron√∫ncia, absolvi√ß√£o sum√°ria","Prepara√ß√£o para plen√°rio","Jurados ‚Äî alistamento","Desaforamento","Organiza√ß√£o da pauta","Sorteio e convoca√ß√£o","Fun√ß√£o do jurado","Forma√ß√£o do conselho de senten√ßa","Sess√µes do j√∫ri","Instru√ß√£o em plen√°rio","Debates","Question√°rio e vota√ß√£o","Senten√ßa no j√∫ri","Ata dos trabalhos","Atribui√ß√µes do presidente","Pris√£o e liberdade provis√≥ria","Crimes de responsabilidade de funcion√°rios","Habeas corpus"
    ]
  },
  {
    id: "dadm", name: "Direito Administrativo", group: "B", priorityRank: 5,
    weightLabel: "Base jur√≠dica", weeklyGoal: 4, weeklyGoalAuto: 4,
    topics: [
      "Organiza√ß√£o administrativa","Administra√ß√£o direta e indireta","Descentraliza√ß√£o","Desconcentra√ß√£o","Princ√≠pios administrativos","√ìrg√£os p√∫blicos","Agentes p√∫blicos","Poderes administrativos","Ato administrativo","Licita√ß√µes","Contratos","Lei 14.133"
    ]
  },
  {
    id: "const", name: "Constitucional", group: "C", priorityRank: 6,
    weightLabel: "Complementar", weeklyGoal: 3, weeklyGoalAuto: 3,
    topics: [
      "Constitui√ß√£o ‚Äî conceito e classifica√ß√µes","Princ√≠pios fundamentais","Direitos fundamentais","Direitos sociais","Nacionalidade","Direitos pol√≠ticos","Organiza√ß√£o pol√≠tico-administrativa","Administra√ß√£o p√∫blica","Servidores p√∫blicos","Poder Judici√°rio","CNJ","Fun√ß√µes essenciais √† justi√ßa"
    ]
  },
  {
    id: "civil", name: "Civil", group: "C", priorityRank: 7,
    weightLabel: "Complementar", weeklyGoal: 3, weeklyGoalAuto: 3,
    topics: [
      "LINDB ‚Äî vig√™ncia","Aplica√ß√£o e interpreta√ß√£o","Conflito no tempo","Efic√°cia no espa√ßo","Pessoas naturais","Personalidade e capacidade","Nome, estado e domic√≠lio","Direitos da personalidade","Pessoas jur√≠dicas","Associa√ß√µes e funda√ß√µes","Bens","Fatos jur√≠dicos","Neg√≥cio jur√≠dico","Atos l√≠citos","Atos il√≠citos"
    ]
  },
  {
    id: "penal", name: "Penal", group: "C", priorityRank: 8,
    weightLabel: "Complementar", weeklyGoal: 3, weeklyGoalAuto: 3,
    topics: [
      "Aplica√ß√£o da lei penal","Legalidade e anterioridade","Lei penal no tempo","Lei penal no espa√ßo","Tempo e lugar do crime","Contagem de prazo","Interpreta√ß√£o","Analogia","Irretroatividade","Teoria do crime","Tipo penal objetivo","Tipo penal subjetivo","Ilicitude","Culpabilidade","Crimes contra pessoa","Crimes contra patrim√¥nio","Crimes contra administra√ß√£o p√∫blica","Crimes hediondos","Abuso de autoridade","ECA"
    ]
  },
  {
    id: "red", name: "Reda√ß√£o", group: "C", priorityRank: 9,
    weightLabel: "Estrat√©gica", weeklyGoal: 2, weeklyGoalAuto: 2,
    topics: [
      "Estrutura dissertativa","Temas atuais","√âtica no servi√ßo p√∫blico","Tecnologia e justi√ßa","Sustentabilidade","Desigualdade social"
    ]
  }
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const STORAGE_KEY = "tjsc_study_v1";
const REDACAO_KEY = "tjsc_redacao_v1";
const METAS_KEY = "tjsc_metas_v1";
let state = { subjects: [] };
let redacaoState = { themes: [], monthCount: 0, monthLabel: "" };
let metasState = { totalWeekly: 20, groups: { A: 50, B: 30, C: 20 } };
let currentView = "dashboard";
let currentNotesTopicId = null;
let searchQuery = "";
let groupFilter = "all";

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function init() {
  loadState();
  loadRedacao();
  loadMetas();
  setupNav();
  setupKeyboard();
  renderView();
}

function buildDefaultSubject(seed) {
  return {
    ...seed,
    topics: seed.topics.map((text, i) => ({
      id: `${seed.id}__${i + 1}`,
      number: i + 1,
      text,
      status: "N√£o iniciado",
      updatedAt: null,
      notes: "",
      reviewDueAt: null
    }))
  };
}

function mergeSeedWithExisting(saved) {
  const map = {};
  if (saved && saved.subjects) {
    saved.subjects.forEach(s => {
      const tMap = {};
      s.topics.forEach(t => { tMap[t.id] = t; });
      map[s.id] = { ...s, topicMap: tMap };
    });
  }
  return SEED_DATA.map(seed => {
    const existing = map[seed.id];
    const base = buildDefaultSubject(seed);
    if (!existing) return base;
    // Keep user-editable fields from saved
    base.weeklyGoal = existing.weeklyGoal ?? seed.weeklyGoal;
    base.topics = base.topics.map(t => {
      const et = existing.topicMap?.[t.id];
      if (!et) return t;
      return { ...t, status: et.status, updatedAt: et.updatedAt, notes: et.notes || "", reviewDueAt: et.reviewDueAt };
    });
    return base;
  });
}

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    const saved = raw ? JSON.parse(raw) : null;
    state.subjects = mergeSeedWithExisting(saved);
  } catch { state.subjects = SEED_DATA.map(buildDefaultSubject); }
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function loadRedacao() {
  try {
    const raw = localStorage.getItem(REDACAO_KEY);
    if (raw) {
      const saved = JSON.parse(raw);
      redacaoState = { ...redacaoState, ...saved };
    }
    // Ensure all themes from seed exist
    const redSeed = SEED_DATA.find(s => s.id === "red");
    if (redSeed) {
      const existingIds = new Set(redacaoState.themes.map(t => t.id));
      redSeed.topics.forEach((text, i) => {
        const id = `red_theme_${i+1}`;
        if (!existingIds.has(id)) {
          redacaoState.themes.push({
            id, text, estrutura: false, tese: false, argumentos: false, conectivos: false, notes: ""
          });
        }
      });
    }
    // Month check
    const now = new Date();
    const ml = `${now.getFullYear()}-${now.getMonth()}`;
    if (redacaoState.monthLabel !== ml) {
      redacaoState.monthCount = 0;
      redacaoState.monthLabel = ml;
    }
  } catch {
    const redSeed = SEED_DATA.find(s => s.id === "red");
    redacaoState.themes = (redSeed?.topics || []).map((text, i) => ({
      id: `red_theme_${i+1}`, text, estrutura: false, tese: false, argumentos: false, conectivos: false, notes: ""
    }));
    const now = new Date();
    redacaoState.monthLabel = `${now.getFullYear()}-${now.getMonth()}`;
  }
}

function saveRedacao() {
  localStorage.setItem(REDACAO_KEY, JSON.stringify(redacaoState));
}

function loadMetas() {
  try {
    const raw = localStorage.getItem(METAS_KEY);
    if (raw) metasState = { ...metasState, ...JSON.parse(raw) };
  } catch {}
}

function saveMetas() {
  localStorage.setItem(METAS_KEY, JSON.stringify(metasState));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setupNav() {
  document.querySelectorAll('.nav-item[data-view]').forEach(el => {
    el.addEventListener('click', () => navigateTo(el.dataset.view));
  });
}

function setupKeyboard() {
  document.addEventListener('keydown', e => {
    if (e.key === '/' && !['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName)) {
      e.preventDefault();
      document.getElementById('globalSearch').focus();
    }
    if (e.key === 'Escape') {
      closeNotesModal();
      document.getElementById('sidebar').classList.remove('open');
    }
  });
}

function navigateTo(view) {
  currentView = view;
  searchQuery = "";
  document.getElementById('globalSearch').value = "";
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const el = document.querySelector(`.nav-item[data-view="${view}"]`);
  if (el) el.classList.add('active');
  document.getElementById('sidebar').classList.remove('open');
  renderView();
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
}

function renderView() {
  const pc = document.getElementById('pageContent');
  switch (currentView) {
    case 'dashboard': pc.innerHTML = renderDashboard(); break;
    case 'materias': pc.innerHTML = renderMaterias(); break;
    case 'metas': pc.innerHTML = renderMetas(); break;
    case 'redacao': pc.innerHTML = renderRedacao(); break;
    case 'leiseca': pc.innerHTML = renderLeiSeca(); break;
    case 'revisao': pc.innerHTML = renderRevisao(); break;
    default: pc.innerHTML = renderDashboard();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getGroupSubjects(g) { return state.subjects.filter(s => s.group === g); }

function getAllTopics() { return state.subjects.flatMap(s => s.topics.map(t => ({ ...t, subjectId: s.id, subjectName: s.name, group: s.group }))); }

function countByStatus(topics, status) { return topics.filter(t => t.status === status).length; }

function pct(done, total) { return total === 0 ? 0 : Math.round((done / total) * 100); }

function groupColor(g) {
  return g === 'A' ? 'group-a' : g === 'B' ? 'group-b' : 'group-c';
}

function groupEmoji(g) { return g === 'A' ? 'üî¥' : g === 'B' ? 'üü°' : 'üü¢'; }

function statusClass(s) {
  if (s === 'Conclu√≠do') return 's-done';
  if (s === 'Em andamento') return 's-progress';
  if (s === 'Revisar') return 's-review';
  return '';
}

function daysAgo(dateStr) {
  if (!dateStr) return Infinity;
  return Math.floor((Date.now() - new Date(dateStr).getTime()) / 86400000);
}

function getReviewQueue() {
  const now = Date.now();
  return getAllTopics().filter(t => {
    if (t.status !== 'Revisar') return false;
    if (!t.reviewDueAt) return true;
    return new Date(t.reviewDueAt).getTime() <= now;
  }).sort((a, b) => {
    const ga = a.group === 'A' ? 0 : a.group === 'B' ? 1 : 2;
    const gb = b.group === 'A' ? 0 : b.group === 'B' ? 1 : 2;
    return ga - gb || (new Date(a.reviewDueAt || 0) - new Date(b.reviewDueAt || 0));
  });
}

function getNextToDo() {
  return getAllTopics()
    .filter(t => t.status === 'N√£o iniciado')
    .sort((a, b) => {
      const ga = a.group === 'A' ? 0 : a.group === 'B' ? 1 : 2;
      const gb = b.group === 'A' ? 0 : b.group === 'B' ? 1 : 2;
      return ga - gb;
    }).slice(0, 8);
}

function getWeekDone(g) {
  const now = new Date();
  const weekStart = new Date(now);
  weekStart.setDate(now.getDate() - now.getDay());
  weekStart.setHours(0, 0, 0, 0);
  return getAllTopics().filter(t => {
    if (g && t.group !== g) return false;
    if (t.status !== 'Conclu√≠do') return false;
    if (!t.updatedAt) return false;
    return new Date(t.updatedAt) >= weekStart;
  }).length;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard() {
  const all = getAllTopics();
  const total = all.length;
  const done = countByStatus(all, 'Conclu√≠do');
  const progress = countByStatus(all, 'Em andamento');
  const review = getReviewQueue().length;

  const groupStats = ['A','B','C'].map(g => {
    const gTopics = all.filter(t => t.group === g);
    const gDone = countByStatus(gTopics, 'Conclu√≠do');
    return { g, total: gTopics.length, done: gDone, pct: pct(gDone, gTopics.length) };
  });

  const nextToDo = getNextToDo();
  const reviewQueue = getReviewQueue().slice(0, 5);

  return `
    <h1 class="page-title fade-in">Dashboard Estrat√©gico</h1>
    <p class="page-subtitle fade-in">Vis√£o geral do seu progresso para o concurso TJ-SC</p>

    <div class="stats-grid">
      <div class="card stat-card general fade-in">
        <div class="stat-accent"></div>
        <div class="stat-label" style="margin-top:8px">Progresso Geral</div>
        <div class="stat-number">${pct(done, total)}%</div>
        <div class="stat-sub">${done} de ${total} t√≥picos conclu√≠dos</div>
        <div class="progress-bar"><div class="progress-fill general" style="width:${pct(done, total)}%"></div></div>
      </div>
      ${groupStats.map(gs => `
        <div class="card stat-card ${groupColor(gs.g)} fade-in">
          <div class="stat-accent"></div>
          <div class="stat-label" style="margin-top:8px">${groupEmoji(gs.g)} Grupo ${gs.g}</div>
          <div class="stat-number">${gs.pct}%</div>
          <div class="stat-sub">${gs.done}/${gs.total} t√≥picos</div>
          <div class="progress-bar"><div class="progress-fill ${groupColor(gs.g)}" style="width:${gs.pct}%"></div></div>
        </div>
      `).join('')}
      <div class="card stat-card fade-in" style="border-left: 3px solid var(--status-review)">
        <div class="stat-label">Fila de Revis√£o</div>
        <div class="stat-number">${review}</div>
        <div class="stat-sub">t√≥picos aguardando revis√£o</div>
      </div>
    </div>

    ${groupStats[0].pct < 100 ? `
    <div class="card fade-in" style="border-left: 3px solid var(--group-a); margin-bottom: 24px; padding: 16px 20px;">
      <div style="display:flex; align-items:center; gap:12px;">
        <span style="font-size: 24px;">‚ö†Ô∏è</span>
        <div>
          <div style="font-weight:600; font-size:14px;">Grupo A precisa de aten√ß√£o ‚Äî ${groupStats[0].pct}% conclu√≠do</div>
          <div style="font-size:13px; color:var(--text-secondary);">Esse grupo representa ~50% da prova. Priorize L√≠ngua Portuguesa e Legisla√ß√£o Interna.</div>
        </div>
      </div>
    </div>` : ''}

    <div class="section-grid">
      <div>
        <div class="section-title"><span class="dot" style="background:var(--accent)"></span> Pr√≥ximos a Estudar</div>
        ${nextToDo.length === 0 ? '<div class="empty-state"><p>Todos os t√≥picos foram iniciados!</p></div>' :
          `<div class="topic-list">${nextToDo.map(t => `
            <div class="topic-item">
              <span class="subject-group-tag ${groupColor(t.group)}">${t.group}</span>
              <span class="topic-text" style="font-size:12.5px">${t.text}</span>
              <span style="font-size:11px; color:var(--text-muted)">${t.subjectName.split(' ')[0]}</span>
            </div>
          `).join('')}</div>`
        }
      </div>
      <div>
        <div class="section-title"><span class="dot" style="background:var(--status-review)"></span> Revis√µes Pendentes</div>
        ${reviewQueue.length === 0 ? '<div class="empty-state"><p>Nenhuma revis√£o pendente</p></div>' :
          `<div>${reviewQueue.map(t => `
            <div class="review-item">
              <div style="flex:1">
                <div class="review-subject">${t.subjectName}</div>
                <div class="review-topic">${t.text}</div>
              </div>
              ${t.reviewDueAt ? `<span class="review-due">${daysAgo(t.reviewDueAt) >= 0 ? 'Vencida' : 'Em breve'}</span>` : '<span class="review-due">Sem data</span>'}
            </div>
          `).join('')}</div>`
        }
        ${reviewQueue.length > 0 ? `<div style="margin-top:8px"><button class="btn btn-sm btn-secondary" onclick="navigateTo('revisao')">Ver todas ‚Üí</button></div>` : ''}
      </div>
    </div>

    <div class="section-title" style="margin-top:8px"><span class="dot" style="background:var(--text-muted)"></span> Progresso por Mat√©ria</div>
    <div class="card" style="padding:0; overflow:hidden">
      ${state.subjects.sort((a,b) => a.priorityRank - b.priorityRank).map(s => {
        const sDone = countByStatus(s.topics, 'Conclu√≠do');
        const sPct = pct(sDone, s.topics.length);
        return `<div style="display:flex; align-items:center; gap:14px; padding:12px 20px; border-bottom:1px solid var(--border-light)">
          <span class="subject-group-tag ${groupColor(s.group)}">${s.group}</span>
          <span style="flex:1; font-size:13.5px; font-weight:500">${s.name}</span>
          <div style="width:120px">
            <div class="progress-bar" style="height:6px"><div class="progress-fill ${groupColor(s.group)}" style="width:${sPct}%"></div></div>
          </div>
          <span style="font-size:13px; font-weight:600; min-width:48px; text-align:right">${sPct}%</span>
        </div>`;
      }).join('')}
    </div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAT√âRIAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMaterias() {
  const filtered = searchQuery
    ? state.subjects.filter(s =>
        s.name.toLowerCase().includes(searchQuery) ||
        s.topics.some(t => t.text.toLowerCase().includes(searchQuery))
      )
    : (groupFilter !== 'all' ? state.subjects.filter(s => s.group === groupFilter) : state.subjects);

  const sorted = [...filtered].sort((a, b) => a.priorityRank - b.priorityRank);

  return `
    <h1 class="page-title fade-in">Mat√©rias</h1>
    <p class="page-subtitle fade-in">Gerencie seus t√≥picos por disciplina e grupo de prioridade</p>

    <div class="filter-chips fade-in">
      <span class="chip ${groupFilter === 'all' ? 'active-all' : ''}" onclick="setGroupFilter('all')">Todas</span>
      <span class="chip ${groupFilter === 'A' ? 'active-a' : ''}" onclick="setGroupFilter('A')">üî¥ Grupo A</span>
      <span class="chip ${groupFilter === 'B' ? 'active-b' : ''}" onclick="setGroupFilter('B')">üü° Grupo B</span>
      <span class="chip ${groupFilter === 'C' ? 'active-c' : ''}" onclick="setGroupFilter('C')">üü¢ Grupo C</span>
    </div>

    ${sorted.map(s => {
      const sDone = countByStatus(s.topics, 'Conclu√≠do');
      const filteredTopics = searchQuery
        ? s.topics.filter(t => t.text.toLowerCase().includes(searchQuery))
        : s.topics;

      return `<div class="subject-card fade-in">
        <div class="subject-header" onclick="toggleSubject('${s.id}', this)">
          <span class="subject-group-tag ${groupColor(s.group)}">${s.group}</span>
          <span class="subject-name">${s.name}</span>
          <span style="font-size:11px; color:var(--text-muted)">${s.weightLabel}</span>
          <span class="subject-progress-mini">${sDone}/${s.topics.length}</span>
          <svg class="subject-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="subject-body" id="body-${s.id}">
          <div class="topic-list">
            ${filteredTopics.map(t => renderTopicItem(t, s)).join('')}
          </div>
        </div>
      </div>`;
    }).join('')}
  `;
}

function renderTopicItem(t, s) {
  return `<div class="topic-item" data-topic-id="${t.id}">
    <span class="topic-number">${t.number}</span>
    <span class="topic-text ${t.status === 'Conclu√≠do' ? 'done' : ''}">${t.text}</span>
    <div class="topic-actions">
      <select class="status-select ${statusClass(t.status)}" onchange="changeStatus('${s.id}','${t.id}',this.value)" title="Alterar status">
        <option ${t.status === 'N√£o iniciado' ? 'selected' : ''}>N√£o iniciado</option>
        <option ${t.status === 'Em andamento' ? 'selected' : ''}>Em andamento</option>
        <option ${t.status === 'Revisar' ? 'selected' : ''}>Revisar</option>
        <option ${t.status === 'Conclu√≠do' ? 'selected' : ''}>Conclu√≠do</option>
      </select>
      <button class="notes-btn ${t.notes ? 'has-notes' : ''}" onclick="openNotesModal('${s.id}','${t.id}')" title="Anota√ß√µes">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
      </button>
    </div>
  </div>`;
}

function toggleSubject(id, headerEl) {
  const body = document.getElementById(`body-${id}`);
  body.classList.toggle('open');
  headerEl.classList.toggle('open');
}

function setGroupFilter(g) {
  groupFilter = g;
  renderView();
}

function changeStatus(subjectId, topicId, newStatus) {
  const sub = state.subjects.find(s => s.id === subjectId);
  if (!sub) return;
  const topic = sub.topics.find(t => t.id === topicId);
  if (!topic) return;
  topic.status = newStatus;
  topic.updatedAt = new Date().toISOString();
  if (newStatus === 'Revisar') {
    const due = new Date();
    due.setDate(due.getDate() + 7);
    topic.reviewDueAt = due.toISOString();
  } else {
    topic.reviewDueAt = null;
  }
  saveState();
  // Update UI inline if possible
  const el = document.querySelector(`[data-topic-id="${topicId}"]`);
  if (el) {
    const textEl = el.querySelector('.topic-text');
    if (textEl) {
      textEl.classList.toggle('done', newStatus === 'Conclu√≠do');
    }
    const sel = el.querySelector('.status-select');
    if (sel) {
      sel.className = `status-select ${statusClass(newStatus)}`;
    }
  }
  toast(`T√≥pico ‚Üí ${newStatus}`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// METAS SEMANAIS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMetas() {
  const groups = [
    { key: 'A', label: 'Grupo A ‚Äî Alt√≠ssima Prioridade', pctKey: 'A', emoji: 'üî¥' },
    { key: 'B', label: 'Grupo B ‚Äî Base Jur√≠dica', pctKey: 'B', emoji: 'üü°' },
    { key: 'C', label: 'Grupo C ‚Äî Complementares', pctKey: 'C', emoji: 'üü¢' },
  ];

  const totalGoal = metasState.totalWeekly;

  return `
    <h1 class="page-title fade-in">Metas Semanais</h1>
    <p class="page-subtitle fade-in">Distribua seus t√≥picos semanais por grupo de prioridade</p>

    <div class="card fade-in" style="margin-bottom:24px">
      <div class="card-header">
        <span class="card-title">Meta Total Semanal</span>
      </div>
      <div style="display:flex;align-items:center;gap:16px;">
        <input class="meta-input" type="number" min="1" max="100" value="${totalGoal}" onchange="updateTotalMeta(this.value)" style="font-size:18px;width:80px;font-weight:700">
        <span style="font-size:14px;color:var(--text-secondary)">t√≥picos por semana</span>
      </div>
      <div style="margin-top:12px;font-size:12px;color:var(--text-muted)">Distribui√ß√£o autom√°tica: A=50%, B=30%, C=20%. Edite manualmente abaixo se preferir.</div>
    </div>

    ${groups.map(g => {
      const autoGoal = Math.round(totalGoal * metasState.groups[g.key] / 100);
      const weekDone = getWeekDone(g.key);
      const weekPct = pct(weekDone, autoGoal);
      return `<div class="card fade-in" style="margin-bottom:16px; border-left: 3px solid var(--${groupColor(g.key)})">
        <div class="meta-row" style="border:none;padding:4px 0">
          <span style="font-size:20px">${g.emoji}</span>
          <span class="meta-label" style="flex:1;min-width:auto">${g.label}</span>
          <div style="display:flex;align-items:center;gap:8px">
            <input class="meta-input" type="number" min="0" max="100" value="${metasState.groups[g.key]}" onchange="updateGroupPct('${g.key}',this.value)" title="% da meta total">
            <span style="font-size:12px;color:var(--text-muted)">%</span>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:12px;margin-top:8px">
          <span style="font-size:13px;font-weight:600">${weekDone}/${autoGoal}</span>
          <div class="meta-bar" style="flex:1"><div class="meta-bar-fill" style="width:${Math.min(weekPct,100)}%;background:var(--${groupColor(g.key)})"></div></div>
          <span style="font-size:13px;font-weight:600;color:${weekPct >= 100 ? 'var(--status-done)' : 'var(--text-secondary)'}">${weekPct}%</span>
        </div>

        <div style="margin-top:12px">
          ${getGroupSubjects(g.key).map(s => {
            const wd = getSubjectWeekDone(s.id);
            return `<div style="display:flex;align-items:center;gap:10px;padding:6px 0;font-size:13px">
              <span style="flex:1;color:var(--text-secondary)">${s.name}</span>
              <span style="font-weight:600">${wd} esta semana</span>
            </div>`;
          }).join('')}
        </div>
      </div>`;
    }).join('')}
  `;
}

function getSubjectWeekDone(subjectId) {
  const now = new Date();
  const weekStart = new Date(now);
  weekStart.setDate(now.getDate() - now.getDay());
  weekStart.setHours(0, 0, 0, 0);
  const sub = state.subjects.find(s => s.id === subjectId);
  if (!sub) return 0;
  return sub.topics.filter(t => t.status === 'Conclu√≠do' && t.updatedAt && new Date(t.updatedAt) >= weekStart).length;
}

function updateTotalMeta(val) {
  metasState.totalWeekly = parseInt(val) || 20;
  saveMetas();
  renderView();
}

function updateGroupPct(g, val) {
  metasState.groups[g] = parseInt(val) || 0;
  saveMetas();
  renderView();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REDA√á√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderRedacao() {
  const now = new Date();
  const monthName = now.toLocaleString('pt-BR', { month: 'long' });

  return `
    <h1 class="page-title fade-in">Reda√ß√£o</h1>
    <p class="page-subtitle fade-in">Acompanhe temas estudados e crit√©rios de qualidade</p>

    <div class="month-counter fade-in">
      ‚úçÔ∏è <strong>${redacaoState.monthCount}</strong> reda√ß√£o(√µes) em ${monthName}
      <button class="btn btn-sm btn-primary" onclick="incrementRedacao()" style="margin-left:8px">+ Reda√ß√£o feita</button>
    </div>

    ${redacaoState.themes.map((theme, i) => `
      <div class="redacao-card fade-in">
        <div class="redacao-title">${i + 1}. ${theme.text}</div>
        <div class="check-row">
          <input type="checkbox" ${theme.estrutura ? 'checked' : ''} onchange="toggleRedacaoCheck('${theme.id}','estrutura',this.checked)">
          <span>Estrutura dissertativa ok?</span>
        </div>
        <div class="check-row">
          <input type="checkbox" ${theme.tese ? 'checked' : ''} onchange="toggleRedacaoCheck('${theme.id}','tese',this.checked)">
          <span>Tese clara?</span>
        </div>
        <div class="check-row">
          <input type="checkbox" ${theme.argumentos ? 'checked' : ''} onchange="toggleRedacaoCheck('${theme.id}','argumentos',this.checked)">
          <span>2 argumentos desenvolvidos?</span>
        </div>
        <div class="check-row">
          <input type="checkbox" ${theme.conectivos ? 'checked' : ''} onchange="toggleRedacaoCheck('${theme.id}','conectivos',this.checked)">
          <span>Conectivos variados usados?</span>
        </div>
        <textarea class="redacao-notes" placeholder="Anota√ß√µes sobre este tema..." oninput="updateRedacaoNotes('${theme.id}',this.value)">${theme.notes || ''}</textarea>
      </div>
    `).join('')}
  `;
}

function toggleRedacaoCheck(themeId, field, val) {
  const theme = redacaoState.themes.find(t => t.id === themeId);
  if (theme) { theme[field] = val; saveRedacao(); }
}

function updateRedacaoNotes(themeId, val) {
  const theme = redacaoState.themes.find(t => t.id === themeId);
  if (theme) { theme.notes = val; saveRedacao(); }
}

function incrementRedacao() {
  redacaoState.monthCount++;
  saveRedacao();
  renderView();
  toast('Reda√ß√£o registrada!');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LEI SECA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderLeiSeca() {
  const legSubject = state.subjects.find(s => s.id === 'leg');
  if (!legSubject) return '<p>Mat√©ria n√£o encontrada.</p>';

  const statutes = {};
  legSubject.topics.forEach(t => {
    const match = t.text.match(/^(.+?)(?:\s*‚Äî\s*(.+))?$/);
    const name = match ? match[1].trim() : t.text;
    if (!statutes[name]) statutes[name] = [];
    statutes[name].push(t);
  });

  const totalLeg = legSubject.topics.length;
  const doneLeg = countByStatus(legSubject.topics, 'Conclu√≠do');
  const progressLeg = countByStatus(legSubject.topics, 'Em andamento');

  return `
    <div class="lei-seca-mode">
      <div class="lei-seca-header">
        <button class="lei-seca-back" onclick="navigateTo('dashboard')">‚Üê Voltar</button>
        <h2>üìú Modo Lei Seca</h2>
      </div>

      <div class="lei-seca-stat">
        Cobertura: <strong>${pct(doneLeg, totalLeg)}%</strong> &nbsp;¬∑&nbsp; ${doneLeg}/${totalLeg} conclu√≠dos &nbsp;¬∑&nbsp; ${progressLeg} em andamento
      </div>

      <div class="topic-list">
        ${legSubject.topics.map(t => `
          <div class="topic-item" data-topic-id="${t.id}" style="padding:8px 12px">
            <span class="topic-number">${t.number}</span>
            <span class="topic-text ${t.status === 'Conclu√≠do' ? 'done' : ''}" style="font-size:14px">${t.text}</span>
            <select class="status-select ${statusClass(t.status)}" onchange="changeStatus('leg','${t.id}',this.value)">
              <option ${t.status === 'N√£o iniciado' ? 'selected' : ''}>N√£o iniciado</option>
              <option ${t.status === 'Em andamento' ? 'selected' : ''}>Em andamento</option>
              <option ${t.status === 'Revisar' ? 'selected' : ''}>Revisar</option>
              <option ${t.status === 'Conclu√≠do' ? 'selected' : ''}>Conclu√≠do</option>
            </select>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REVIS√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderRevisao() {
  const queue = getReviewQueue();

  return `
    <h1 class="page-title fade-in">Fila de Revis√£o</h1>
    <p class="page-subtitle fade-in">T√≥picos marcados para revis√£o com prazo ‚â§ 7 dias</p>

    ${queue.length === 0 ? `
      <div class="empty-state card fade-in" style="padding:60px">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
        <p>Nenhuma revis√£o pendente. Continue estudando!</p>
      </div>
    ` : `
      <div style="margin-bottom:12px;font-size:13px;color:var(--text-secondary)">${queue.length} t√≥pico(s) para revisar</div>
      ${queue.map(t => `
        <div class="review-item fade-in" style="margin-bottom:8px">
          <span class="subject-group-tag ${groupColor(t.group)}">${t.group}</span>
          <div style="flex:1">
            <div class="review-subject">${t.subjectName}</div>
            <div class="review-topic">${t.text}</div>
          </div>
          ${t.reviewDueAt ? `<span style="font-size:11px;color:var(--text-muted)">${new Date(t.reviewDueAt).toLocaleDateString('pt-BR')}</span>` : ''}
          <select class="status-select ${statusClass(t.status)}" onchange="changeStatus('${t.subjectId}','${t.id}',this.value)" style="margin-left:8px">
            <option>N√£o iniciado</option>
            <option>Em andamento</option>
            <option selected>Revisar</option>
            <option>Conclu√≠do</option>
          </select>
        </div>
      `).join('')}
    `}
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEARCH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleSearch(val) {
  searchQuery = val.toLowerCase().trim();
  if (currentView === 'dashboard' && searchQuery) {
    currentView = 'materias';
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.querySelector('.nav-item[data-view="materias"]').classList.add('active');
  }
  renderView();
  // Auto-expand subjects with matching topics
  if (searchQuery) {
    state.subjects.forEach(s => {
      const hasMatch = s.topics.some(t => t.text.toLowerCase().includes(searchQuery));
      if (hasMatch) {
        const body = document.getElementById(`body-${s.id}`);
        const header = body?.previousElementSibling;
        if (body && !body.classList.contains('open')) {
          body.classList.add('open');
          if (header) header.classList.add('open');
        }
      }
    });
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTES MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openNotesModal(subjectId, topicId) {
  currentNotesTopicId = { subjectId, topicId };
  const sub = state.subjects.find(s => s.id === subjectId);
  const topic = sub?.topics.find(t => t.id === topicId);
  if (!topic) return;
  document.getElementById('notesModalTitle').textContent = `Anota√ß√µes ‚Äî ${topic.text}`;
  document.getElementById('notesModalText').value = topic.notes || '';
  document.getElementById('notesModal').classList.add('show');
  setTimeout(() => document.getElementById('notesModalText').focus(), 100);
}

function closeNotesModal() {
  document.getElementById('notesModal').classList.remove('show');
  currentNotesTopicId = null;
}

function saveNotes() {
  if (!currentNotesTopicId) return;
  const { subjectId, topicId } = currentNotesTopicId;
  const sub = state.subjects.find(s => s.id === subjectId);
  const topic = sub?.topics.find(t => t.id === topicId);
  if (topic) {
    topic.notes = document.getElementById('notesModalText').value;
    saveState();
    toast('Anota√ß√£o salva');
  }
  closeNotesModal();
  renderView();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function markVisibleDone() {
  const items = document.querySelectorAll('.topic-item[data-topic-id]');
  let count = 0;
  items.forEach(el => {
    const tid = el.dataset.topicId;
    // Find topic
    for (const s of state.subjects) {
      const t = s.topics.find(x => x.id === tid);
      if (t && t.status !== 'Conclu√≠do') {
        t.status = 'Conclu√≠do';
        t.updatedAt = new Date().toISOString();
        t.reviewDueAt = null;
        count++;
        break;
      }
    }
  });
  if (count > 0) {
    saveState();
    renderView();
    toast(`${count} t√≥pico(s) marcados como conclu√≠do`);
  } else {
    toast('Nenhum t√≥pico vis√≠vel para concluir');
  }
}

function exportData() {
  const data = {
    version: 1,
    exportedAt: new Date().toISOString(),
    state,
    redacaoState,
    metasState
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `tjsc-estudos-${new Date().toISOString().slice(0, 10)}.json`;
  a.click();
  URL.revokeObjectURL(url);
  toast('Dados exportados com sucesso');
}

function importData(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const data = JSON.parse(e.target.result);
      if (data.state) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data.state));
      }
      if (data.redacaoState) {
        localStorage.setItem(REDACAO_KEY, JSON.stringify(data.redacaoState));
      }
      if (data.metasState) {
        localStorage.setItem(METAS_KEY, JSON.stringify(data.metasState));
      }
      loadState();
      loadRedacao();
      loadMetas();
      renderView();
      toast('Dados importados com sucesso');
    } catch { toast('Erro ao importar arquivo'); }
  };
  reader.readAsText(file);
  event.target.value = '';
}

function confirmReset() {
  if (confirm('‚ö†Ô∏è Tem certeza que deseja resetar todo o progresso? Esta a√ß√£o n√£o pode ser desfeita.')) {
    localStorage.removeItem(STORAGE_KEY);
    localStorage.removeItem(REDACAO_KEY);
    localStorage.removeItem(METAS_KEY);
    loadState();
    loadRedacao();
    loadMetas();
    renderView();
    toast('Progresso resetado');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg) {
  const container = document.getElementById('toastContainer');
  const el = document.createElement('div');
  el.className = 'toast';
  el.textContent = msg;
  container.appendChild(el);
  setTimeout(() => { el.classList.add('out'); setTimeout(() => el.remove(), 300); }, 2500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// START
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
init();
</script>
</body>
</html>